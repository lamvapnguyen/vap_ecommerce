var ImageDialog={preInit:function(){var n;tinyMCEPopup.requireLangPack();(n=tinyMCEPopup.getParam("external_image_list_url"))&&document.write('<script language="javascript" type="text/javascript" src="'+tinyMCEPopup.editor.documentBaseURI.toAbsolute(n)+'"><\/script>')},browseResource:function(){if(window.parent.open_fmgr){var n=document.forms[0],t=tinyMCEPopup.editor;window.parent.open_fmgr(function(t){n.src.value=t},this._insertType,this._insertNumber)}},browseResource_lg:function(){if(window.parent.open_fmgr){var n=document.forms[0],t=tinyMCEPopup.editor;window.parent.open_fmgr(function(t){n.src_lg.value=t},"medium_image",1)}},_insertType:"thumb_image",_insertNumber:1,_show_large:!0,init:function(){var n=document.forms[0],t=tinyMCEPopup.editor;t.settings.isBroswer?document.getElementById("src").style.width="170px":(document.getElementById("srcbrowser_link").style.display="none",document.getElementById("orginalinsert_tr").style.display="none",this._insertType="thumb_image",this._insertNumber=1);e=t.selection.getNode();this.fillFileList("image_list","tinyMCEImageList");e.nodeName=="IMG"?(n.src_lg.value=t.dom.getAttrib(e,"src_lg"),selectByValue(n,"cssclass",this.getAttrib(e,"cssclass")),n.src.value=t.dom.getAttrib(e,"src"),n.alt.value=t.dom.getAttrib(e,"alt"),n.desc.value=t.dom.getAttrib(e,"desc"),n.border.value=this.getAttrib(e,"border"),n.vspace.value=this.getAttrib(e,"vspace"),n.hspace.value=this.getAttrib(e,"hspace"),n.width.value=t.dom.getAttrib(e,"width"),n.height.value=t.dom.getAttrib(e,"height"),n.imageframe.value=t.dom.getAttrib(e,"frame"),n.insert.value=t.getLang("update"),this.styleVal=t.dom.getAttrib(e,"style"),selectByValue(n,"image_list",n.src.value),selectByValue(n,"align",this.getAttrib(e,"align")),this.updateStyle(),this._insertType="thumb_image",this._insertNumber=1,document.getElementById("orginalinsert_tr").style.display="none"):(this._insertType=t.settings.insertType,this._insertNumber=t.settings.insertNumber,this._insertType!="large_image"&&this._insertType!="medium_image"?document.getElementById("orginalinsert_tr").style.display="none":(n.border.value=t.settings.default_image_border,n.vspace.value=t.settings.editor_image_vspace,n.hspace.value=t.settings.editor_image_hspace,selectByValue(n,"align",t.settings.editor_image_align)));t.settings.insertType=="medium_image"&&(document.getElementById("trDimensions").style.display="")},formSubmit:function(){var t=document.forms[0],n=tinyMCEPopup.editor,r,u,i;switch(this._insertType){case"thumb_image":if(n.settings.insertType=="photos")if(i=t.src.value,tinyMCEPopup.restoreSelection(),r=n.selection.getNode(),i&&i!=""&&r&&r.nodeName=="IMG")if(t.alt.value=t.alt.value.replace('"',"'"),t.desc.value=t.desc.value.replace('"',"'"),u={alt:t.alt.value,desc:t.desc.value,frame:t.imageframe.value,"class":"thumb_photo",src:n.dom.getAttrib(r,"src"),large:n.dom.getAttrib(r,"large"),src_lg:n.dom.getAttrib(r,"src_lg"),cssclass:n.dom.getAttrib(r,"cssclass")},u.src!=i)window.parent.insert_photos(ImageDialog.srcToArray(i),function(t){if(t&&t.length>0){var i=t[0];typeof i=="string"?u.src=u.large=i:(u.src=i.thumb,u.large=i.medium);n.dom.setAttribs(r,u)}window.parent.hide_loading();tinyMCEPopup.close();return});else{n.dom.setAttribs(r,u);tinyMCEPopup.close();return}else{r.nodeName=="IMG"&&(n.dom.remove(r),n.execCommand("mceRepaint"));tinyMCEPopup.close();return}else ImageDialog.update();break;case"medium_image":t.orginalInsert.checked?ImageDialog.update():(i=t.src.value,i&&i!=""&&window.parent.insert_medium_image(ImageDialog.srcToArray(i),function(i){var r,f,u;if(i&&i.length>0)for(r={alt:t.alt.value,desc:t.desc.value,width:t.width.value,vspace:t.vspace.value,hspace:t.hspace.value,border:t.border.value,align:getSelectValue(t,"align"),src_lg:t.src_lg.value,cssclass:getSelectValue(t,"cssclass")},f=0;f<i.length;f++){if(u=i[f],typeof u=="string"){r.src=u;n.execCommand("mceInsertContent",!1,'<img id="__mce_tmp" />',{skip_undo:1});n.dom.setAttribs("__mce_tmp",r);n.dom.setAttrib("__mce_tmp","id","");n.undoManager.add();continue}r.src=u.medium;n.execCommand("mceInsertContent",!1,'<a id="__mce_a_tmp" target="_blank"><img id="__mce_tmp" border="0" /><\/a>',{skip_undo:1});n.dom.setAttribs("__mce_tmp",r);n.dom.setAttrib("__mce_tmp","id","");n.dom.setAttribs("__mce_a_tmp",{href:u.large});n.dom.setAttrib("__mce_a_tmp","id","");n.undoManager.add()}tinyMCEPopup.close();return}));break;case"large_image":t.orginalInsert.checked?ImageDialog.update():(i=t.src.value,i&&i!=""&&window.parent.insert_large_image(ImageDialog.srcToArray(i),function(i){var r,f,u;if(i&&i.length>0)for(r={alt:t.alt.value,desc:t.desc.value,vspace:t.vspace.value,hspace:t.hspace.value,border:t.border.value,align:getSelectValue(t,"align"),src_lg:t.src_lg.value,cssclass:getSelectValue(t,"cssclass")},f=0;f<i.length;f++){if(u=i[f],typeof u=="string"){r.src=u;n.execCommand("mceInsertContent",!1,'<img id="__mce_tmp" />',{skip_undo:1});n.dom.setAttribs("__mce_tmp",r);n.dom.setAttrib("__mce_tmp","id","");n.undoManager.add();continue}if(r.src=u.thumb,n.execCommand("mceInsertContent",!1,'<img id="__mce_tmp" />',{skip_undo:1}),n.dom.setAttribs("__mce_tmp",r),n.dom.setAttrib("__mce_tmp","id",""),n.undoManager.add(),r.src=u.medium,u.large)n.execCommand("mceInsertContent",!1,'<a id="__mce_a_tmp" target="_blank"><img id="__mce_tmp" border="0" /><\/a>',{skip_undo:1}),n.dom.setAttribs("__mce_tmp",r),n.dom.setAttrib("__mce_tmp","id",""),n.dom.setAttribs("__mce_a_tmp",{href:u.large}),n.dom.setAttrib("__mce_a_tmp","id",""),n.undoManager.add();else{n.execCommand("mceInsertContent",!1,'<img id="__mce_tmp" />',{skip_undo:1});n.dom.setAttribs("__mce_tmp",r);n.dom.setAttrib("__mce_tmp","id","");n.undoManager.add();continue}}tinyMCEPopup.close();return}));break;case"photos":i=t.src.value;i&&i!=""&&window.parent.insert_photos(ImageDialog.srcToArray(i),function(i){if(i&&i.length>0){var r={alt:t.alt.value,desc:t.desc.value,frame:t.imageframe.value},u=0,f="",e=function(){if(u<i.length){var t=i[u];typeof t=="string"?r.src=r.large=t:(r.src=t.thumb,r.large=t.medium);f+='<img class="thumb_photo" frame="'+r.frame+'" alt="'+r.alt+'" desc="'+r.desc+'" src="'+r.src+'" large="'+r.large+'"/>';u++;window.setTimeout(e,100)}else n.execCommand("mceInsertContent",!1,f,{skip_undo:1}),n.undoManager.add(),window.parent.hide_loading(),tinyMCEPopup.close()};e();return}tinyMCEPopup.close();return})}return!1},srcToArray:function(n){var i=[],u,r,t;if(n&&n!=""&&n[0]=="["&&n[n.length-1]=="]"){for(n=n.substr(1,n.length-2),u=n.split(";"),r=0;r<u.length;r++)t=u[r],t!=""&&t.length>2&&i.push(t.substr(1,t.length-2));return i}return i.push(n),i},fillFileList:function(n,t){var r=tinyMCEPopup.dom,i=r.get(n);t=window[t];t&&t.length>0?(i.options[i.options.length]=new Option("",""),tinymce.each(t,function(n){i.options[i.options.length]=new Option(n[0],n[1])})):r.remove(r.getParent(n,"tr"))},update:function(){var t=document.forms[0],r=t.elements,n=tinyMCEPopup.editor,i={},f,u,o,e;if(tinyMCEPopup.restoreSelection(),t.src.value===""){n.selection.getNode().nodeName=="IMG"&&(n.dom.remove(n.selection.getNode()),n.execCommand("mceRepaint"));tinyMCEPopup.close();return}if(n.settings.inline_styles?i.style=this.styleVal:i=tinymce.extend(i,{vspace:r.vspace.value,hspace:r.hspace.value,border:r.border.value,width:r.width.value,align:getSelectValue(t,"align"),cssclass:getSelectValue(t,"cssclass"),src_lg:r.src_lg.value}),tinymce.extend(i,{src:t.src.value,alt:t.alt.value,desc:t.desc.value,src_lg:t.src_lg.value}),f=n.selection.getNode(),f&&f.nodeName=="IMG")n.dom.setAttribs(f,i);else if(u=t.src.value,this._insertNumber==1||u[0]!="["||u[u.length-1]!="]")n.execCommand("mceInsertContent",!1,'<img id="__mce_tmp" />',{skip_undo:1}),n.dom.setAttribs("__mce_tmp",i),n.dom.setAttrib("__mce_tmp","id",""),n.undoManager.add();else for(o=ImageDialog.srcToArray(u),e=0;e<o.length;e++)i.src=o[e],n.execCommand("mceInsertContent",!1,'<img id="__mce_tmp" />',{skip_undo:1}),n.dom.setAttribs("__mce_tmp",i),n.dom.setAttrib("__mce_tmp","id",""),n.undoManager.add();tinyMCEPopup.close()},updateStyle:function(){var r=tinyMCEPopup.dom,n,t,i=document.forms[0];tinyMCEPopup.editor.settings.inline_styles&&(n=tinyMCEPopup.dom.parseStyle(this.styleVal),t=getSelectValue(i,"align"),t?t=="left"||t=="right"?(n.float=t,delete n["vertical-align"]):(n["vertical-align"]=t,delete n.float):(delete n.float,delete n["vertical-align"]),t=i.border.value,t||t=="0"?n.border=t=="0"?"0":t+"px solid black":delete n.border,t=i.width.value,t||t=="0"?n.width=t=="0"?"auto":t:delete n.width,t=i.hspace.value,t?(delete n.margin,n["margin-left"]=t+"px",n["margin-right"]=t+"px"):(delete n["margin-left"],delete n["margin-right"]),t=i.vspace.value,t?(delete n.margin,n["margin-top"]=t+"px",n["margin-bottom"]=t+"px"):(delete n["margin-top"],delete n["margin-bottom"]),n=tinyMCEPopup.dom.parseStyle(r.serializeStyle(n)),this.styleVal=r.serializeStyle(n))},getAttrib:function(n,t){var f=tinyMCEPopup.editor,r=f.dom,i,u;if(f.settings.inline_styles)switch(t){case"align":if((i=r.getStyle(n,"float"))||(i=r.getStyle(n,"vertical-align")))return i;break;case"hspace":if(i=r.getStyle(n,"margin-left"),u=r.getStyle(n,"margin-right"),i&&i==u)return parseInt(i.replace(/[^0-9]/g,""));break;case"vspace":if(i=r.getStyle(n,"margin-top"),u=r.getStyle(n,"margin-bottom"),i&&i==u)return parseInt(i.replace(/[^0-9]/g,""));break;case"border":if(i=0,tinymce.each(["top","right","bottom","left"],function(t){if(t=r.getStyle(n,"border-"+t+"-width"),!t||t!=i&&i!==0)return i=0,!1;t&&(i=t)}),i)return parseInt(i.replace(/[^0-9]/g,""))}return(i=r.getAttrib(n,t))?i:""},resetImageData:function(){var n=document.forms[0];n.width.value=n.height.value=""},updateImageData:function(){var n=document.forms[0],t=ImageDialog;n.width.value==""&&(n.width.value=t.preloadImg.width);n.height.value==""&&(n.height.value=t.preloadImg.height)},getImageData:function(){var n=document.forms[0];this.preloadImg=new Image;this.preloadImg.onload=this.updateImageData;this.preloadImg.onerror=this.resetImageData;this.preloadImg.src=tinyMCEPopup.editor.documentBaseURI.toAbsolute(n.src.value)},getImageData_lg:function(){var n=document.forms[0];this.preloadImg=new Image;this.preloadImg.src=tinyMCEPopup.editor.documentBaseURI.toAbsolute(n.src_lg.value)}};ImageDialog.preInit();tinyMCEPopup.onInit.add(ImageDialog.init,ImageDialog);