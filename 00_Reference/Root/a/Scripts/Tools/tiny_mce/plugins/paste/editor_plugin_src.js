(function(){function n(n,t){return n.getParam(t,i[t])}var t=tinymce.each,i={paste_auto_cleanup_on_paste:!0,paste_enable_default_filters:!0,paste_block_drop:!1,paste_retain_style_properties:"none",paste_strip_class_attributes:"mso",paste_remove_spans:!1,paste_remove_styles:!1,paste_remove_styles_if_webkit:!0,paste_convert_middot_lists:!0,paste_convert_headers_to_strong:!1,paste_dialog_width:"450",paste_dialog_height:"400",paste_text_use_dialog:!1,paste_text_sticky:!1,paste_text_notifyalways:!1,paste_text_linebreaktype:"p",paste_text_replacements:[[/\u2026/g,"..."],[/[\x93\x94\u201c\u201d]/g,'"'],[/[\x60\x91\x92\u2018\u2019]/g,"'"]]};tinymce.create("tinymce.plugins.PastePlugin",{init:function(i,r){function f(t,r){var f=i.dom,e,o;u.onPreProcess.dispatch(u,t);t.node=f.create("div",0,t.content);tinymce.isGecko&&(e=i.selection.getRng(!0),e.startContainer==e.endContainer&&e.startContainer.nodeType==3&&(o=f.select("p,h1,h2,h3,h4,h5,h6,pre",t.node),o.length==1&&t.content.indexOf("__MCE_ITEM__")===-1&&f.remove(o.reverse(),!0)));u.onPostProcess.dispatch(u,t);t.content=i.serializer.serialize(t.node,{getInner:1});!r&&i.pasteAsPlainText?(u._insertPlainText(i,f,t.content),n(i,"paste_text_sticky")||(i.pasteAsPlainText=!1,i.controlManager.setActive("pastetext",!1))):u._insert(t.content)}function e(n){var u,c,e,a,o=i.selection,r=i.dom,s=i.getBody(),v,l;if((n.clipboardData||r.doc.dataTransfer)&&(l=(n.clipboardData||r.doc.dataTransfer).getData("Text"),i.pasteAsPlainText)){n.preventDefault();f({content:l.replace(/\r?\n/g,"<br />")});return}if(!r.get("_mcePaste")){if(u=r.add(s,"div",{id:"_mcePaste","class":"mcePaste","data-mce-bogus":"1"},'﻿﻿<br data-mce-bogus="1">'),v=s!=i.getDoc().body?r.getPos(i.selection.getStart(),s).y:s.scrollTop+r.getViewPort().y,r.setStyles(u,{position:"absolute",left:-1e4,top:v,width:1,height:1,overflow:"hidden"}),tinymce.isIE){if(a=o.getRng(),e=r.doc.body.createTextRange(),e.moveToElementText(u),e.execCommand("Paste"),r.remove(u),u.innerHTML==="﻿"){i.execCommand("mcePasteWord");n.preventDefault();return}return o.setRng(a),o.setContent(""),setTimeout(function(){f({content:u.innerHTML})},0),tinymce.dom.Event.cancel(n)}function h(n){n.preventDefault()}r.bind(i.getDoc(),"mousedown",h);r.bind(i.getDoc(),"keydown",h);c=i.selection.getRng();u=u.firstChild;e=i.getDoc().createRange();e.setStart(u,0);e.setEnd(u,1);o.setRng(e);window.setTimeout(function(){var n="",u;r.select("div.mcePaste > div.mcePaste").length?n="<pre>"+r.encode(l).replace(/\r?\n/g,"<br />")+"<\/pre>":(u=r.select("div.mcePaste"),t(u,function(i){var u=i.firstChild;u&&u.nodeName=="DIV"&&u.style.marginTop&&u.style.backgroundColor&&r.remove(u,1);t(r.select("span.Apple-style-span",i),function(n){r.remove(n,1)});t(r.select("br[data-mce-bogus]",i),function(n){r.remove(n)});i.parentNode.className!="mcePaste"&&(n+=i.innerHTML)}));t(r.select("div.mcePaste"),function(n){r.remove(n)});c&&o.setRng(c);f({content:n});r.unbind(i.getDoc(),"mousedown",h);r.unbind(i.getDoc(),"keydown",h)},0)}}var u=this;u.editor=i;u.url=r;u.onPreProcess=new tinymce.util.Dispatcher(u);u.onPostProcess=new tinymce.util.Dispatcher(u);u.onPreProcess.add(u._preProcess);u.onPostProcess.add(u._postProcess);u.onPreProcess.add(function(n,t){i.execCallback("paste_preprocess",n,t)});u.onPostProcess.add(function(n,t){i.execCallback("paste_postprocess",n,t)});i.onKeyDown.addToTop(function(n,t){if((tinymce.isMac?t.metaKey:t.ctrlKey)&&t.keyCode==86||t.shiftKey&&t.keyCode==45)return!1});i.pasteAsPlainText=!1;i.addCommand("mceInsertClipboardContent",function(n,t){f(t,!0)});n(i,"paste_text_use_dialog")||i.addCommand("mcePasteText",function(){var t=tinymce.util.Cookie;i.pasteAsPlainText=!i.pasteAsPlainText;i.controlManager.setActive("pastetext",i.pasteAsPlainText);i.pasteAsPlainText&&!t.get("tinymcePasteText")&&(n(i,"paste_text_sticky")?i.windowManager.alert(i.translate("paste.plaintext_mode_sticky")):i.windowManager.alert(i.translate("paste.plaintext_mode_sticky")),n(i,"paste_text_notifyalways")||t.set("tinymcePasteText","1",new Date((new Date).getFullYear()+1,12,31)))});i.addButton("pastetext",{title:"paste.paste_text_desc",cmd:"mcePasteText"});i.addButton("selectall",{title:"paste.selectall_desc",cmd:"selectall"});n(i,"paste_auto_cleanup_on_paste")&&(tinymce.isOpera||/Firefox\/2/.test(navigator.userAgent)?i.onKeyDown.addToTop(function(n,t){((tinymce.isMac?t.metaKey:t.ctrlKey)&&t.keyCode==86||t.shiftKey&&t.keyCode==45)&&e(t)}):i.onPaste.addToTop(function(n,t){return e(t)}));n(i,"paste_block_drop")&&i.onInit.add(function(){i.dom.bind(i.getBody(),["dragend","dragover","draggesture","dragdrop","drop","drag"],function(n){return n.preventDefault(),n.stopPropagation(),!1})});u._legacySupport()},getInfo:function(){return{longname:"Paste text/word",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/paste",version:tinymce.majorVersion+"."+tinymce.minorVersion}},_preProcess:function(i,r){function e(n){t(n,function(n){u=n.constructor==RegExp?u.replace(n,""):u.replace(n[0],n[1])})}var f=this.editor,u=r.content,l=tinymce.grep,o=tinymce.explode,a=tinymce.trim,h,s;if(f.settings.paste_enable_default_filters!=!1){if(tinymce.isIE&&document.documentMode>=9&&e([[/(?:<br>&nbsp;[\s\r\n]+|<br>)*(<\/?(h[1-6r]|p|div|address|pre|form|table|tbody|thead|tfoot|th|tr|td|li|ol|ul|caption|blockquote|center|dl|dt|dd|dir|fieldset)[^>]*>)(?:<br>&nbsp;[\s\r\n]+|<br>)*/g,"$1"]]),/class="?Mso|style="[^"]*\bmso-|w:WordDocument/i.test(u)||r.wordContent){r.wordContent=!0;e([/^\s*(&nbsp;)+/gi,/(&nbsp;|<br[^>]*>)+\s*$/gi]);n(f,"paste_convert_headers_to_strong")&&(u=u.replace(/<p [^>]*class="?MsoHeading"?[^>]*>(.*?)<\/p>/gi,"<p><strong>$1<\/strong><\/p>"));n(f,"paste_convert_middot_lists")&&e([[/<!--\[if !supportLists\]-->/gi,"$&__MCE_ITEM__"],[/(<span[^>]+(?:mso-list:|:\s*symbol)[^>]+>)/gi,"$1__MCE_ITEM__"],[/(<p[^>]+(?:MsoListParagraph)[^>]+>)/gi,"$1__MCE_ITEM__"]]);e([/<!--[\s\S]+?-->/gi,/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|img|meta|link|style|\w:\w+)(?=[\s\/>]))[^>]*>/gi,[/<(\/?)s>/gi,"<$1strike>"],[/&nbsp;/gi," "]]);do h=u.length,u=u.replace(/(<[a-z][^>]*\s)(?:id|name|language|type|on\w+|\w+:\w+)=(?:"[^"]*"|\w+)\s?/gi,"$1");while(h!=u.length);n(f,"paste_retain_style_properties").replace(/^none$/i,"").length==0?u=u.replace(/<\/?span[^>]*>/gi,""):e([[/<span\s+style\s*=\s*"\s*mso-spacerun\s*:\s*yes\s*;?\s*"\s*>([\s\u00a0]*)<\/span>/gi,function(n,t){return t.length>0?t.replace(/./," ").slice(Math.floor(t.length/2)).split("").join(" "):""}],[/(<[a-z][^>]*)\sstyle="([^"]*)"/gi,function(n,i,r){var u=[],f=0,e=o(a(r).replace(/&quot;/gi,"'"),";");return t(e,function(n){function e(n){return n+(n!=="0"&&/\d$/.test(n))?"px":""}var i,t,r=o(n,":");if(r.length==2){i=r[0].toLowerCase();t=r[1].toLowerCase();switch(i){case"mso-padding-alt":case"mso-padding-top-alt":case"mso-padding-right-alt":case"mso-padding-bottom-alt":case"mso-padding-left-alt":case"mso-margin-alt":case"mso-margin-top-alt":case"mso-margin-right-alt":case"mso-margin-bottom-alt":case"mso-margin-left-alt":case"mso-table-layout-alt":case"mso-height":case"mso-width":case"mso-vertical-align-alt":u[f++]=i.replace(/^mso-|-alt$/g,"")+":"+e(t);return;case"horiz-align":u[f++]="text-align:"+t;return;case"vert-align":u[f++]="vertical-align:"+t;return;case"font-color":case"mso-foreground":u[f++]="color:"+t;return;case"mso-background":case"mso-highlight":u[f++]="background:"+t;return;case"mso-default-height":u[f++]="min-height:"+e(t);return;case"mso-default-width":u[f++]="min-width:"+e(t);return;case"mso-padding-between-alt":u[f++]="border-collapse:separate;border-spacing:"+e(t);return;case"text-line-through":(t=="single"||t=="double")&&(u[f++]="text-decoration:line-through");return;case"mso-zero-height":t=="yes"&&(u[f++]="display:none");return}if(/^(mso|column|font-emph|lang|layout|line-break|list-image|nav|panose|punct|row|ruby|sep|size|src|tab-|table-border|text-(?!align|decor|indent|trans)|top-bar|version|vnd|word-break)/.test(i))return;u[f++]=i+":"+r[1]}}),f>0?i+' style="'+u.join(";")+'"':i}]])}if(n(f,"paste_convert_headers_to_strong")&&e([[/<h[1-6][^>]*>/gi,"<p><strong>"],[/<\/h[1-6][^>]*>/gi,"<\/strong><\/p>"]]),e([[/Version:[\d.]+\nStartHTML:\d+\nEndHTML:\d+\nStartFragment:\d+\nEndFragment:\d+/gi,""]]),s=n(f,"paste_strip_class_attributes"),s!=="none"){function c(n,t){if(s==="all")return"";var i=l(o(t.replace(/^(["'])(.*)\1$/,"$2")," "),function(n){return/^(?!mso)/i.test(n)});return i.length?' class="'+i.join(" ")+'"':""}u=u.replace(/ class="([^"]+)"/gi,c);u=u.replace(/ class=([\-\w]+)/gi,c)}n(f,"paste_remove_spans")&&(u=u.replace(/<\/?span[^>]*>/gi,""));r.content=u}},_postProcess:function(i,r){var o=this,e=o.editor,f=e.dom,u;e.settings.paste_enable_default_filters!=!1&&(r.wordContent&&(t(f.select("a",r.node),function(n){n.href&&n.href.indexOf("#_Toc")==-1||f.remove(n,1)}),n(e,"paste_convert_middot_lists")&&o._convertLists(i,r),u=n(e,"paste_retain_style_properties"),tinymce.is(u,"string")&&u!=="all"&&u!=="*"&&(u=tinymce.explode(u.replace(/^none$/i,"")),t(f.select("*",r.node),function(n){var e={},o=0,t,i,r;if(u)for(t=0;t<u.length;t++)i=u[t],r=f.getStyle(n,i),r&&(e[i]=r,o++);f.setAttrib(n,"style","");u&&o>0?f.setStyles(n,e):n.nodeName!="SPAN"||n.className||f.remove(n,!0)}))),n(e,"paste_remove_styles")||n(e,"paste_remove_styles_if_webkit")&&tinymce.isWebKit?t(f.select("*[style]",r.node),function(n){n.removeAttribute("style");n.removeAttribute("data-mce-style")}):tinymce.isWebKit&&t(f.select("*",r.node),function(n){n.removeAttribute("data-mce-style")}))},_convertLists:function(n,i){var r=n.editor.dom,u,s,e=-1,f,h=[],c,o;t(r.select("p",i.node),function(n){for(var l="",i,a,y,v,o=n.firstChild;o&&o.nodeType==3;o=o.nextSibling)l+=o.nodeValue;l=n.innerHTML.replace(/<\/?\w+[^>]*>/gi,"").replace(/&nbsp;/g," ");/^(__MCE_ITEM__)+[\u2022\u00b7\u00a7\u00d8o\u25CF]\s*\u00a0*/.test(l)&&(i="ul");/^__MCE_ITEM__\s*\w+\.\s*\u00a0+/.test(l)&&(i="ol");i?(f=parseFloat(n.style.marginLeft||0),f>e&&h.push(f),u&&i==c?f>e?u=s.appendChild(r.create(i)):f<e&&(y=tinymce.inArray(h,f),v=r.getParents(u.parentNode,i),u=v[v.length-1-y]||u):(u=r.create(i),r.insertAfter(u,n)),t(r.select("span",n),function(n){var t=n.innerHTML.replace(/<\/?\w+[^>]*>/gi,"");i=="ul"&&/^__MCE_ITEM__[\u2022\u00b7\u00a7\u00d8o\u25CF]/.test(t)?r.remove(n):/^__MCE_ITEM__[\s\S]*\w+\.(&nbsp;|\u00a0)*\s*/.test(t)&&r.remove(n)}),a=n.innerHTML,a=i=="ul"?n.innerHTML.replace(/__MCE_ITEM__/g,"").replace(/^[\u2022\u00b7\u00a7\u00d8o\u25CF]\s*(&nbsp;|\u00a0)+\s*/,""):n.innerHTML.replace(/__MCE_ITEM__/g,"").replace(/^\s*\w+\.(&nbsp;|\u00a0)+\s*/,""),s=u.appendChild(r.create("li",0,a)),r.remove(n),e=f,c=i):u=e=0});o=i.node.innerHTML;o.indexOf("__MCE_ITEM__")!=-1&&(i.node.innerHTML=o.replace(/__MCE_ITEM__/g,""))},_insert:function(n,t){var i=this.editor,r=i.selection.getRng();i.selection.isCollapsed()||r.startContainer==r.endContainer||i.getDoc().execCommand("Delete",!1,null);i.execCommand("mceInsertContent",!1,n,{skip_undo:t})},_insertPlainText:function(i,r,u){function e(n){t(n,function(n){u=n.constructor==RegExp?u.replace(n,""):u.replace(n[0],n[1])})}var s,b,h,l,o,f,a,v,d=i.getWin(),p=i.getDoc(),y=i.selection,w=tinymce.is,g=tinymce.inArray,k=n(i,"paste_text_linebreaktype"),c=n(i,"paste_text_replacements");if(typeof u=="string"&&u.length>0){if(/<(?:p|br|h[1-6]|ul|ol|dl|table|t[rdh]|div|blockquote|fieldset|pre|address|center)[^>]*>/i.test(u)?e([/[\n\r]+/g]):e([/\r+/g]),e([[/<\/(?:p|h[1-6]|ul|ol|dl|table|div|blockquote|fieldset|pre|address|center)>/gi,"\n\n"],[/<br[^>]*>|<\/tr>/gi,"\n"],[/<\/t[dh]>\s*<t[dh][^>]*>/gi,"\t"],/<[a-z!\/?][^>]*>/gi,[/&nbsp;/gi," "],[/(?:(?!\n)\s)*(\n+)(?:(?!\n)\s)*/gi,"$1"],[/\n{3,}/g,"\n\n"],/^\s+|\s+$/g]),u=r.decode(tinymce.html.Entities.encodeRaw(u)),y.isCollapsed()||p.execCommand("Delete",!1,null),w(c,"array")||w(c,"array")?e(c):w(c,"string")&&e(new RegExp(c,"gi")),k=="none"?e([[/\n+/g," "]]):k=="br"?e([[/\n/g,"<br />"]]):e([/^\s+|\s+$/g,[/\n\n/g,"<\/p><p>"],[/\n/g,"<br />"]]),(h=u.indexOf("<\/p><p>"))!=-1){l=u.lastIndexOf("<\/p><p>");o=y.getNode();f=[];do if(o.nodeType==1){if(o.nodeName=="TD"||o.nodeName=="BODY")break;f[f.length]=o}while(o=o.parentNode);if(f.length>0){for(a=u.substring(0,h),v="",s=0,b=f.length;s<b;s++)a+="<\/"+f[s].nodeName.toLowerCase()+">",v+="<"+f[f.length-s-1].nodeName.toLowerCase()+">";u=h==l?a+v+u.substring(h+7):a+u.substring(h+4,l+4)+v+u.substring(l+7)}}i.execCommand("mceInsertRawHTML",!1,u+'<span id="_plain_text_marker">&nbsp;<\/span>');window.setTimeout(function(){var u=r.get("_plain_text_marker"),i,n,t,f;y.select(u,!1);p.execCommand("Delete",!1,null);u=null;i=y.getStart();n=r.getViewPort(d);t=r.getPos(i).y;f=i.clientHeight;(t<n.y||t+f>n.y+n.h)&&(p.body.scrollTop=t<n.y?t:t-n.h+25)},0)}},_legacySupport:function(){var i=this,t=i.editor;t.addCommand("mcePasteWord",function(){t.windowManager.open({file:i.url+"/pasteword.htm",width:parseInt(n(t,"paste_dialog_width")),height:parseInt(n(t,"paste_dialog_height")),inline:1})});n(t,"paste_text_use_dialog")&&t.addCommand("mcePasteText",function(){t.windowManager.open({file:i.url+"/pastetext.htm",width:parseInt(n(t,"paste_dialog_width")),height:parseInt(n(t,"paste_dialog_height")),inline:1})});t.addButton("pasteword",{title:"paste.paste_word_desc",cmd:"mcePasteWord"})}});tinymce.PluginManager.add("paste",tinymce.plugins.PastePlugin)})();