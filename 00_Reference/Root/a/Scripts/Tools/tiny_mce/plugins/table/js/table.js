function insertTable(){var i=document.forms[0],r=tinyMCEPopup.editor,t=r.dom,c=2,l=2,o=0,w=-1,b=-1,k,f,s,d,a,g,nt,u="",e,n,v,y,p,tt,it,h;if(tinyMCEPopup.restoreSelection(),!AutoValidator.validate(i))return tinyMCEPopup.alert(AutoValidator.getErrorMessages(i).join(". ")+"."),!1;if(n=t.getParent(r.selection.getNode(),"table"),c=i.elements.cols.value,l=i.elements.rows.value,o=i.elements.border.value!=""?i.elements.border.value:0,w=i.elements.cellpadding.value!=""?i.elements.cellpadding.value:"",b=i.elements.cellspacing.value!=""?i.elements.cellspacing.value:"",k=getSelectValue(i,"align"),g=getSelectValue(i,"tframe"),nt=getSelectValue(i,"rules"),f=i.elements.width.value,s=i.elements.height.value,bordercolor=i.elements.bordercolor.value,bgcolor=i.elements.bgcolor.value,d=getSelectValue(i,"class"),id=i.elements.id.value,summary=i.elements.summary.value,style=i.elements.style.value,dir=i.elements.dir.value,lang=i.elements.lang.value,background=i.elements.backgroundimage.value,a=i.elements.caption.checked,v=tinyMCEPopup.getParam("table_cell_limit",!1),y=tinyMCEPopup.getParam("table_row_limit",!1),p=tinyMCEPopup.getParam("table_col_limit",!1),p&&c>p)return tinyMCEPopup.alert(r.getLang("table_dlg.col_limit").replace(/\{\$cols\}/g,p)),!1;if(y&&l>y)return tinyMCEPopup.alert(r.getLang("table_dlg.row_limit").replace(/\{\$rows\}/g,y)),!1;if(v&&c*l>v)return tinyMCEPopup.alert(r.getLang("table_dlg.cell_limit").replace(/\{\$cells\}/g,v)),!1;if(action=="update")return t.setAttrib(n,"cellPadding",w,!0),t.setAttrib(n,"cellSpacing",b,!0),t.setAttrib(n,"border",o),t.setAttrib(n,"align",k),t.setAttrib(n,"frame",g),t.setAttrib(n,"rules",nt),t.setAttrib(n,"class",d),t.setAttrib(n,"style",style),t.setAttrib(n,"id",id),t.setAttrib(n,"summary",summary),t.setAttrib(n,"dir",dir),t.setAttrib(n,"lang",lang),e=r.dom.select("caption",n)[0],e&&!a&&e.parentNode.removeChild(e),!e&&a&&(e=n.ownerDocument.createElement("caption"),tinymce.isIE||(e.innerHTML='<br data-mce-bogus="1"/>'),n.insertBefore(e,n.firstChild)),f&&r.settings.inline_styles?(t.setStyle(n,"width",f),t.setAttrib(n,"width","")):(t.setAttrib(n,"width",f,!0),t.setStyle(n,"width","")),t.setAttrib(n,"borderColor",""),t.setAttrib(n,"bgColor",""),t.setAttrib(n,"background",""),s&&r.settings.inline_styles?(t.setStyle(n,"height",s),t.setAttrib(n,"height","")):(t.setAttrib(n,"height",s,!0),t.setStyle(n,"height","")),n.style.backgroundImage=background!=""?"url('"+background+"')":"",bordercolor!=""?(n.style.borderColor=bordercolor,n.style.borderStyle=n.style.borderStyle==""?"solid":n.style.borderStyle,n.style.borderWidth=o==""?"1px":o):n.style.borderColor="",n.style.backgroundColor=bgcolor,n.style.height=getCSSSize(s),r.addVisual(),r.nodeChanged(),r.execCommand("mceEndUndoLevel"),(i.width.value!=orgTableWidth||i.height.value!=orgTableHeight)&&r.execCommand("mceRepaint"),tinyMCEPopup.close(),!0;for(u+="<table",u+=makeAttrib("id",id),u+=makeAttrib("border",o),u+=makeAttrib("cellpadding",w),u+=makeAttrib("cellspacing",b),u+=makeAttrib("data-mce-new","1"),f&&r.settings.inline_styles?(style&&(style+="; "),/^[0-9\.]+$/.test(f)&&(f+="px"),style+="width: "+f):u+=makeAttrib("width",f),u+=makeAttrib("align",k),u+=makeAttrib("frame",g),u+=makeAttrib("rules",nt),u+=makeAttrib("class",d),u+=makeAttrib("style",style),u+=makeAttrib("summary",summary),u+=makeAttrib("dir",dir),u+=makeAttrib("lang",lang),u+=">",a&&(u+=tinymce.isIE?"<caption><\/caption>":'<caption><br data-mce-bogus="1"/><\/caption>'),tt=0;tt<l;tt++){for(u+="<tr>",it=0;it<c;it++)u+=tinymce.isIE?"<td><\/td>":'<td><br data-mce-bogus="1"/><\/td>';u+="<\/tr>"}u+="<\/table>";r.settings.fix_table_elements?(h="",r.focus(),r.selection.setContent('<br class="_mce_marker" />'),tinymce.each("h1,h2,h3,h4,h5,h6,p".split(","),function(n){h&&(h+=",");h+=n+" ._mce_marker"}),tinymce.each(r.dom.select(h),function(n){r.dom.split(r.dom.getParent(n,"h1,h2,h3,h4,h5,h6,p"),n)}),t.setOuterHTML(t.select("br._mce_marker")[0],u)):r.execCommand("mceInsertContent",!1,u);tinymce.each(t.select("table[data-mce-new]"),function(n){var i=t.select("td",n);try{r.selection.select(i[0],!0);r.selection.collapse()}catch(u){}t.setAttrib(n,"data-mce-new","")});r.addVisual();r.execCommand("mceEndUndoLevel");tinyMCEPopup.close()}function makeAttrib(n,t){var r=document.forms[0],i=r.elements[n];return((typeof t=="undefined"||t==null)&&(t="",i&&(t=i.value)),t=="")?"":(t=t.replace(/&/g,"&amp;"),t=t.replace(/\"/g,"&quot;"),t=t.replace(/</g,"&lt;"),t=t.replace(/>/g,"&gt;")," "+n+'="'+t+'"')}function init(){var u,r,f;tinyMCEPopup.resizeToInnerSize();document.getElementById("backgroundimagebrowsercontainer").innerHTML=getBrowserHTML("backgroundimagebrowser","backgroundimage","image","table");document.getElementById("backgroundimagebrowsercontainer").innerHTML=getBrowserHTML("backgroundimagebrowser","backgroundimage","image","table");document.getElementById("bordercolor_pickcontainer").innerHTML=getColorPickerHTML("bordercolor_pick","bordercolor");document.getElementById("bgcolor_pickcontainer").innerHTML=getColorPickerHTML("bgcolor_pick","bgcolor");var r=2,c=2,l=tinyMCEPopup.getParam("table_default_border","0"),a=tinyMCEPopup.getParam("table_default_cellpadding",""),v=tinyMCEPopup.getParam("table_default_cellspacing",""),e="",o="",s="",y="",p="",w="",b="",k="",d="",g="",nt="",tt="",p="",y="",it="",rt="",h=tinyMCEPopup.editor,i=h.dom,n=document.forms[0],t=i.getParent(h.selection.getNode(),"table");if(action=tinyMCEPopup.getWindowArg("action"),action||(action=t?"update":"insert"),t&&action!="insert"){for(u=t.rows,r=0,f=0;f<u.length;f++)u[f].cells.length>r&&(r=u[f].cells.length);r=r;c=u.length;st=i.parseStyle(i.getAttrib(t,"style"));l=trimSize(getStyle(t,"border","borderWidth"));a=i.getAttrib(t,"cellpadding","");v=i.getAttrib(t,"cellspacing","");o=trimSize(getStyle(t,"width","width"));s=trimSize(getStyle(t,"height","height"));y=convertRGBToHex(getStyle(t,"bordercolor","borderLeftColor"));p=convertRGBToHex(getStyle(t,"bgcolor","backgroundColor"));e=i.getAttrib(t,"align",e);rt=i.getAttrib(t,"frame");it=i.getAttrib(t,"rules");w=tinymce.trim(i.getAttrib(t,"class").replace(/mceItem.+/g,""));b=i.getAttrib(t,"id");k=i.getAttrib(t,"summary");d=i.serializeStyle(st);g=i.getAttrib(t,"dir");nt=i.getAttrib(t,"lang");tt=getStyle(t,"background","backgroundImage").replace(new RegExp("url\\(['\"]?([^'\"]*)['\"]?\\)","gi"),"$1");n.caption.checked=t.getElementsByTagName("caption").length>0;orgTableWidth=o;orgTableHeight=s;action="update";n.insert.value=h.getLang("update")}addClassesToList("class","table_styles");TinyMCE_EditableSelects.init();selectByValue(n,"align",e);selectByValue(n,"tframe",rt);selectByValue(n,"rules",it);selectByValue(n,"class",w,!0,!0);n.cols.value=r;n.rows.value=c;n.border.value=l;n.cellpadding.value=a;n.cellspacing.value=v;n.width.value=o;n.height.value=s;n.bordercolor.value=y;n.bgcolor.value=p;n.id.value=b;n.summary.value=k;n.style.value=d;n.dir.value=g;n.lang.value=nt;n.backgroundimage.value=tt;updateColor("bordercolor_pick","bordercolor");updateColor("bgcolor_pick","bgcolor");isVisible("backgroundimagebrowser")&&(document.getElementById("backgroundimage").style.width="180px");action=="update"&&(n.cols.disabled=!0,n.rows.disabled=!0)}function changedSize(){var n=document.forms[0],t=dom.parseStyle(n.style.value),i=n.height.value;t.height=i!=""?getCSSSize(i):"";n.style.value=dom.serializeStyle(t)}function changedBackgroundImage(){var n=document.forms[0],t=dom.parseStyle(n.style.value);t["background-image"]="url('"+n.backgroundimage.value+"')";n.style.value=dom.serializeStyle(t)}function changedBorder(){var n=document.forms[0],t=dom.parseStyle(n.style.value);n.border.value!=""&&n.bordercolor.value!=""&&(t["border-width"]=n.border.value+"px");n.style.value=dom.serializeStyle(t)}function changedColor(){var n=document.forms[0],t=dom.parseStyle(n.style.value);t["background-color"]=n.bgcolor.value;n.bordercolor.value!=""&&(t["border-color"]=n.bordercolor.value,t["border-width"]||(t["border-width"]=n.border.value==""?"1px":n.border.value+"px"));n.style.value=dom.serializeStyle(t)}function changedStyle(){var t=document.forms[0],n=dom.parseStyle(t.style.value);t.backgroundimage.value=n["background-image"]?n["background-image"].replace(new RegExp("url\\(['\"]?([^'\"]*)['\"]?\\)","gi"),"$1"):"";n.width&&(t.width.value=trimSize(n.width));n.height&&(t.height.value=trimSize(n.height));n["background-color"]&&(t.bgcolor.value=n["background-color"],updateColor("bgcolor_pick","bgcolor"));n["border-color"]&&(t.bordercolor.value=n["border-color"],updateColor("bordercolor_pick","bordercolor"))}tinyMCEPopup.requireLangPack();var action,orgTableWidth,orgTableHeight,dom=tinyMCEPopup.editor.dom;tinyMCEPopup.onInit.add(init);