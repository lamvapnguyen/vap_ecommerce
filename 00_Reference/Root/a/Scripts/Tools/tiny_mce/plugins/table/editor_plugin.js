(function(n){function r(n,t){var u=t.ownerDocument,i=u.createRange(),r;return i.setStartBefore(t),i.setEnd(n.endContainer,n.endOffset),r=u.createElement("body"),r.appendChild(i.cloneContents()),r.innerHTML.replace(/<(br|img|object|embed|input|textarea)[^>]*>/gi,"-").replace(/<[^>]+>/g,"").length==0}function u(r,u,f){function w(n,t){return n=n.cloneNode(t),n.removeAttribute("id"),n}function nt(){var n=0;e=[];t(["thead","tbody","tfoot"],function(i){var f=u.select("> "+i+" tr",r);t(f,function(r,f){f+=n;t(u.select("> td, > th",r),function(n,t){var u,r,o,s;if(e[f])while(e[f][t])t++;for(o=h(n,"rowspan"),s=h(n,"colspan"),r=f;r<f+o;r++)for(e[r]||(e[r]=[]),u=t;u<t+s;u++)e[r][u]={part:i,real:r==f&&u==t,elm:n,rowspan:o,colspan:s}})});n+=f.length})}function b(n,t){var i;return i=e[t],i?i[n]:void 0}function h(n,t){return parseInt(n.getAttribute(t)||1)}function o(n,t,i){n&&(i=parseInt(i),i===1?n.removeAttribute(t,1):n.setAttribute(t,i,1))}function p(n){return n&&(u.hasClass(n.elm,"mceSelected")||n==v)}function k(){var n=[];return t(r.rows,function(i){t(i.cells,function(t){if(u.hasClass(t,"mceSelected")||t==v.elm)return n.push(i),!1})}),n}function it(){var n=u.createRng();n.setStartAfter(r);n.setEndAfter(r);f.setRng(n);u.remove(r)}function l(i){var r;return n.walk(i,function(f){var e;if(f.nodeType==3)return t(u.getParents(f.parentNode,null,i).reverse(),function(n){n=w(n,!1);r?e&&e.appendChild(n):r=e=n;e=n}),e&&(e.innerHTML=n.isIE?"&nbsp;":'<br data-mce-bogus="1" />'),!1},"childNodes"),i=w(i,!1),o(i,"rowspan",1),o(i,"colspan",1),r?i.appendChild(r):n.isIE||(i.innerHTML='<br data-mce-bogus="1" />'),i}function d(){var n=u.createRng();if(t(u.select("tr",r),function(n){n.cells.length==0&&u.remove(n)}),u.select("tr",r).length==0){n.setStartAfter(r);n.setEndAfter(r);f.setRng(n);u.remove(r);return}t(u.select("thead,tbody,tfoot",r),function(n){n.rows.length==0&&u.remove(n)});nt();row=e[Math.min(e.length-1,s.y)];row&&(f.select(row[Math.min(row.length-1,s.x)].elm,!0),f.collapse(!0))}function g(n,t,i,r){for(var s,o,c,f=e[t][n].elm.parentNode,h=1;h<=i;h++)if(f=u.getNext(f,"tr"),f){for(s=n;s>=0;s--)if(c=e[t+h][s].elm,c.parentNode==f){for(o=1;o<=r;o++)u.insertAfter(l(c),c);break}if(s==-1)for(o=1;o<=r;o++)f.insertBefore(l(f.cells[0]),f.cells[0])}}function tt(){t(e,function(n,i){t(n,function(n,t){var r,f,e;if(p(n)&&(n=n.elm,r=h(n,"colspan"),f=h(n,"rowspan"),r>1||f>1)){for(o(n,"rowspan",1),o(n,"colspan",1),e=0;e<r-1;e++)u.insertAfter(l(n),n);g(t,i,f-1,r)}})})}function rt(i,r,f){var l,v,w,k,g,y,h,it,i,p,rt;if(i?(pos=a(i),l=pos.x,v=pos.y,w=l+(r-1),k=v+(f-1)):(l=s.x,v=s.y,w=c.x,k=c.y),h=b(l,v),it=b(w,k),h&&it&&h.part==it.part){for(tt(),nt(),h=b(l,v).elm,o(h,"colspan",w-l+1),o(h,"rowspan",k-v+1),y=v;y<=k;y++)for(g=l;g<=w;g++)e[y]&&e[y][g]&&(i=e[y][g].elm,i!=h&&(p=n.grep(i.childNodes),t(p,function(n){h.appendChild(n)}),p.length&&(p=n.grep(h.childNodes),rt=0,t(p,function(n){n.nodeName=="BR"&&u.getAttrib(n,"data-mce-bogus")&&rt++<p.length-1&&h.removeChild(n)})),u.remove(i)));d()}}function ut(n){var i,r,b,f,c,a,v,y,s;for(t(e,function(r,u){return t(r,function(t){if(p(t)&&(t=t.elm,c=t.parentNode,a=w(c,!1),i=u,n))return!1}),n?!i:void 0}),f=0;f<e[0].length;f++)if(e[i][f]&&(r=e[i][f].elm,r!=b)){if(n){if(i>0&&e[i-1][f]&&(y=e[i-1][f].elm,s=h(y,"rowspan"),s>1)){o(y,"rowspan",s+1);continue}}else if(s=h(r,"rowspan"),s>1){o(r,"rowspan",s+1);continue}v=l(r);o(v,"colspan",r.colSpan);a.appendChild(v);b=r}a.hasChildNodes()&&(n?c.parentNode.insertBefore(a,c):u.insertAfter(a,c))}function ft(n){var i,r;t(e,function(r){return t(r,function(t,r){if(p(t)&&(i=r,n))return!1}),n?!i:void 0});t(e,function(t,f){var e,c,s;t[i]&&(e=t[i].elm,e!=r&&(s=h(e,"colspan"),c=h(e,"rowspan"),s==1?n?(e.parentNode.insertBefore(l(e),e),g(i,f,c-1,s)):(u.insertAfter(l(e),e),g(i,f,c-1,s)):o(e,"colspan",e.colSpan+1),r=e))})}function et(){var i=[];t(e,function(r){t(r,function(r,f){p(r)&&n.inArray(i,f)===-1&&(t(e,function(n){var t=n[f].elm,i;i=h(t,"colspan");i>1?o(t,"colspan",i-1):u.remove(t)}),i.push(f))})});d()}function ot(){function i(n){var f,i,r;f=u.getNext(n,"tr");t(n.cells,function(n){var t=h(n,"rowspan");t>1&&(o(n,"rowspan",t-1),i=a(n),g(i.x,i.y,1,1))});i=a(n.cells[0]);t(e[i.y],function(n){var t;n=n.elm;n!=r&&(t=h(n,"rowspan"),t<=1?u.remove(n):o(n,"rowspan",t-1),r=n)})}var n;n=k();t(n.reverse(),function(n){i(n)});d()}function st(){var n=k();return u.remove(n),d(),n}function ht(){var n=k();return t(n,function(t,i){n[i]=w(t,!0)}),n}function ct(n,r){var h=k(),f=h[r?0:h.length-1],s=f.cells.length;t(e,function(n){var i;return s=0,t(n,function(n){n.real&&(s+=n.colspan);n.elm.parentNode==f&&(i=1)}),i?!1:void 0});r||n.reverse();t(n,function(n){var t=n.cells.length,e;for(i=0;i<t;i++)e=n.cells[i],o(e,"colspan",1),o(e,"rowspan",1);for(i=t;i<s;i++)n.appendChild(l(n.cells[t-1]));for(i=s;i<t;i++)u.remove(n.cells[i]);r?f.parentNode.insertBefore(n,f):u.insertAfter(n,f)})}function a(n){var i;return t(e,function(r,u){return t(r,function(t,r){if(t.elm==n)return i={x:r,y:u},!1}),!i}),i}function lt(n){s=a(n)}function at(){var n,i;return n=i=0,t(e,function(r,u){t(r,function(t,r){var f,o;p(t)&&(t=e[u][r],r>n&&(n=r),u>i&&(i=u),t.real&&(f=t.colspan-1,o=t.rowspan-1,f&&r+f>n&&(n=r+f),o&&u+o>i&&(i=u+o)))})}),{x:n,y:i}}function vt(n){var t,i,l,v,r,f,o,h;if(c=a(n),s&&c){for(t=Math.min(s.x,c.x),i=Math.min(s.y,c.y),l=Math.max(s.x,c.x),v=Math.max(s.y,c.y),r=l,f=v,y=i;y<=f;y++)n=e[y][t],n.real||t-(n.colspan-1)<t&&(t-=n.colspan-1);for(x=t;x<=r;x++)n=e[i][x],n.real||i-(n.rowspan-1)<i&&(i-=n.rowspan-1);for(y=i;y<=v;y++)for(x=t;x<=l;x++)n=e[y][x],n.real&&(o=n.colspan-1,h=n.rowspan-1,o&&x+o>r&&(r=x+o),h&&y+h>f&&(f=y+h));for(u.removeClass(u.select("td.mceSelected,th.mceSelected"),"mceSelected"),y=i;y<=f;y++)for(x=t;x<=r;x++)e[y][x]&&u.addClass(e[y][x].elm,"mceSelected")}}var e,s,c,v;nt();v=u.getParent(f.getStart(),"th,td");v&&(s=a(v),c=at(),v=b(s.x,s.y));n.extend(this,{deleteTable:it,split:tt,merge:rt,insertRow:ut,insertCol:ft,deleteCols:et,deleteRows:ot,cutRows:st,copyRows:ht,pasteRows:ct,getPos:a,setStartCell:lt,setEndCell:vt})}var t=n.each;n.create("tinymce.plugins.TablePlugin",{init:function(i,f){function h(n){var t=i.selection,r=i.dom.getParent(n||t.getNode(),"table");if(r)return new u(r,i.dom,t)}function s(){i.getBody().style.webkitUserSelect="";i.dom.removeClass(i.dom.select("td.mceSelected,th.mceSelected"),"mceSelected")}var o,e;t([["table","table.desc","mceInsertTable",!0],["delete_table","table.del","mceTableDelete"],["delete_col","table.delete_col_desc","mceTableDeleteCol"],["delete_row","table.delete_row_desc","mceTableDeleteRow"],["col_after","table.col_after_desc","mceTableInsertColAfter"],["col_before","table.col_before_desc","mceTableInsertColBefore"],["row_after","table.row_after_desc","mceTableInsertRowAfter"],["row_before","table.row_before_desc","mceTableInsertRowBefore"],["row_props","table.row_desc","mceTableRowProps",!0],["cell_props","table.cell_desc","mceTableCellProps",!0],["split_cells","table.split_cells_desc","mceTableSplitCells",!0],["merge_cells","table.merge_cells_desc","mceTableMergeCells",!0]],function(n){i.addButton(n[0],{title:n[1],cmd:n[2],ui:n[3]})});n.isIE||i.onClick.add(function(n,t){t=t.target;t.nodeName==="TABLE"&&(n.selection.select(t),n.nodeChanged())});i.onPreProcess.add(function(n,t){for(var i,r=n.dom,u,f=r.select("table",t.node),e=f.length;e--;)i=f[e],r.setAttrib(i,"data-mce-style",""),(u=r.getAttrib(i,"width"))&&(r.setStyle(i,"width",u),r.setAttrib(i,"width","")),(u=r.getAttrib(i,"height"))&&(r.setStyle(i,"height",u),r.setAttrib(i,"height",""))});i.onNodeChange.add(function(n,t,i){var r;i=n.selection.getStart();r=n.dom.getParent(i,"td,th,caption");t.setActive("table",i.nodeName==="TABLE"||!!r);r&&r.nodeName==="CAPTION"&&(r=0);t.setDisabled("delete_table",!r);t.setDisabled("delete_col",!r);t.setDisabled("delete_table",!r);t.setDisabled("delete_row",!r);t.setDisabled("col_after",!r);t.setDisabled("col_before",!r);t.setDisabled("row_after",!r);t.setDisabled("row_before",!r);t.setDisabled("row_props",!r);t.setDisabled("cell_props",!r);t.setDisabled("split_cells",!r);t.setDisabled("merge_cells",!r)});i.onInit.add(function(t){var l,u,i=t.dom,f;if(o=t.windowManager,t.onMouseDown.add(function(n,t){t.button!=2&&(s(),u=i.getParent(t.target,"td,th"),l=i.getParent(u,"table"))}),i.bind(t.getDoc(),"mouseover",function(n){var e,o,r=n.target;u&&(f||r!=u)&&(r.nodeName=="TD"||r.nodeName=="TH")&&(o=i.getParent(r,"table"),o==l&&(f||(f=h(o),f.setStartCell(u),t.getBody().style.webkitUserSelect="none"),f.setEndCell(r)),e=t.selection.getSel(),e.removeAllRanges?e.removeAllRanges():e.empty(),n.preventDefault())}),t.onMouseUp.add(function(t){var e,s=t.selection,o,y=s.getSel(),h,r,c,v;if(u){f&&(t.getBody().style.webkitUserSelect="");function a(t,i){var r=new n.dom.TreeWalker(t,t);do{if(t.nodeType==3&&n.trim(t.nodeValue).length!=0){i?e.setStart(t,0):e.setEnd(t,t.nodeValue.length);return}if(t.nodeName=="BR"){i?e.setStartBefore(t):e.setEndBefore(t);return}}while(t=i?r.next():r.prev())}if(o=i.select("td.mceSelected,th.mceSelected"),o.length>0){e=i.createRng();r=o[0];v=o[o.length-1];a(r,1);h=new n.dom.TreeWalker(r,i.getParent(o[0],"table"));do if(r.nodeName=="TD"||r.nodeName=="TH"){if(!i.hasClass(r,"mceSelected"))break;c=r}while(r=h.next());a(c);s.setRng(e)}t.nodeChanged();u=f=l=null}}),t.onKeyUp.add(function(){s()}),t&&t.plugins.contextmenu&&t.plugins.contextmenu.onContextMenu.add(function(n,i,r){var u,o=t.selection,f=o.getNode()||t.getBody();t.dom.getParent(r,"td")||t.dom.getParent(r,"th")||t.dom.select("td.mceSelected,th.mceSelected").length?(i.removeAll(),f.nodeName!="A"||t.dom.getAttrib(f,"name")||(i.add({title:"advanced.link_desc",icon:"link",cmd:t.plugins.advlink?"mceAdvLink":"mceLink",ui:!0}),i.add({title:"advanced.unlink_desc",icon:"unlink",cmd:"UnLink"}),i.addSeparator()),f.nodeName=="IMG"&&f.className.indexOf("mceItem")==-1&&(i.add({title:"advanced.image_desc",icon:"image",cmd:t.plugins.advimage?"mceAdvImage":"mceImage",ui:!0}),i.addSeparator()),i.add({title:"table.desc",icon:"table",cmd:"mceInsertTable",value:{action:"insert"}}),i.add({title:"table.props_desc",icon:"table_props",cmd:"mceInsertTable"}),i.add({title:"table.del",icon:"delete_table",cmd:"mceTableDelete"}),i.addSeparator(),u=i.addMenu({title:"table.cell"}),u.add({title:"table.cell_desc",icon:"cell_props",cmd:"mceTableCellProps"}),u.add({title:"table.split_cells_desc",icon:"split_cells",cmd:"mceTableSplitCells"}),u.add({title:"table.merge_cells_desc",icon:"merge_cells",cmd:"mceTableMergeCells"}),u=i.addMenu({title:"table.row"}),u.add({title:"table.row_desc",icon:"row_props",cmd:"mceTableRowProps"}),u.add({title:"table.row_before_desc",icon:"row_before",cmd:"mceTableInsertRowBefore"}),u.add({title:"table.row_after_desc",icon:"row_after",cmd:"mceTableInsertRowAfter"}),u.add({title:"table.delete_row_desc",icon:"delete_row",cmd:"mceTableDeleteRow"}),u.addSeparator(),u.add({title:"table.cut_row_desc",icon:"cut",cmd:"mceTableCutRow"}),u.add({title:"table.copy_row_desc",icon:"copy",cmd:"mceTableCopyRow"}),u.add({title:"table.paste_row_before_desc",icon:"paste",cmd:"mceTablePasteRowBefore"}).setDisabled(!e),u.add({title:"table.paste_row_after_desc",icon:"paste",cmd:"mceTablePasteRowAfter"}).setDisabled(!e),u=i.addMenu({title:"table.col"}),u.add({title:"table.col_before_desc",icon:"col_before",cmd:"mceTableInsertColBefore"}),u.add({title:"table.col_after_desc",icon:"col_after",cmd:"mceTableInsertColAfter"}),u.add({title:"table.delete_col_desc",icon:"delete_col",cmd:"mceTableDeleteCol"})):i.add({title:"table.desc",icon:"table",cmd:"mceInsertTable"})}),!n.isIE){function c(){for(var n=t.getBody().lastChild;n&&n.nodeType==3&&!n.nodeValue.length;n=n.previousSibling);n&&n.nodeName=="TABLE"&&t.dom.add(t.getBody(),"p",null,'<br mce_bogus="1" />')}n.isGecko&&t.onKeyDown.add(function(n,t){var i,u,f=n.dom;(t.keyCode==37||t.keyCode==38)&&(i=n.selection.getRng(),u=f.getParent(i.startContainer,"table"),u&&n.getBody().firstChild==u&&r(i,u)&&(i=f.createRng(),i.setStartBefore(u),i.setEndBefore(u),n.selection.setRng(i),t.preventDefault()))});t.onKeyUp.add(c);t.onSetContent.add(c);t.onVisualAid.add(c);t.onPreProcess.add(function(n,t){var i=t.node.lastChild;i&&i.childNodes.length==1&&i.firstChild.nodeName=="BR"&&n.dom.remove(i)});c()}});t({mceTableSplitCells:function(n){n.split()},mceTableMergeCells:function(n){var r,u,t;t=i.dom.getParent(i.selection.getNode(),"th,td");t&&(r=t.rowSpan,u=t.colSpan);i.dom.select("td.mceSelected,th.mceSelected").length?n.merge():o.open({url:f+"/merge_cells.htm",width:240+parseInt(i.getLang("table.merge_cells_delta_width",0)),height:110+parseInt(i.getLang("table.merge_cells_delta_height",0)),inline:1},{rows:r,cols:u,onaction:function(i){n.merge(t,i.cols,i.rows)},plugin_url:f})},mceTableInsertRowBefore:function(n){n.insertRow(!0)},mceTableInsertRowAfter:function(n){n.insertRow()},mceTableInsertColBefore:function(n){n.insertCol(!0)},mceTableInsertColAfter:function(n){n.insertCol()},mceTableDeleteCol:function(n){n.deleteCols()},mceTableDeleteRow:function(n){n.deleteRows()},mceTableCutRow:function(n){e=n.cutRows()},mceTableCopyRow:function(n){e=n.copyRows()},mceTablePasteRowBefore:function(n){n.pasteRows(e,!0)},mceTablePasteRowAfter:function(n){n.pasteRows(e)},mceTableDelete:function(n){n.deleteTable()}},function(n,t){i.addCommand(t,function(){var t=h();t&&(n(t),i.execCommand("mceRepaint"),s())})});t({mceInsertTable:function(n){o.open({url:f+"/table.htm",width:400+parseInt(i.getLang("table.table_delta_width",0)),height:320+parseInt(i.getLang("table.table_delta_height",0)),inline:1},{plugin_url:f,action:n?n.action:0})},mceTableRowProps:function(){o.open({url:f+"/row.htm",width:400+parseInt(i.getLang("table.rowprops_delta_width",0)),height:295+parseInt(i.getLang("table.rowprops_delta_height",0)),inline:1},{plugin_url:f})},mceTableCellProps:function(){o.open({url:f+"/cell.htm",width:400+parseInt(i.getLang("table.cellprops_delta_width",0)),height:295+parseInt(i.getLang("table.cellprops_delta_height",0)),inline:1},{plugin_url:f})}},function(n,t){i.addCommand(t,function(t,i){n(i)})})}});n.PluginManager.add("table",n.plugins.TablePlugin)})(tinymce);