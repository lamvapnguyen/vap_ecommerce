(function(){var n=tinymce.dom.Event,i=tinymce.each,t=tinymce.DOM;tinymce.create("tinymce.plugins.ContextMenu",{init:function(t){function u(t,f){if(r=null,f&&f.button==2){r=t.selection.getRng();return}i._menu&&(i._menu.removeAll(),i._menu.destroy(),n.remove(t.getDoc(),"click",u))}var i=this,r,f,e;i.editor=t;e=t.settings.contextmenu_never_use_native;i.onContextMenu=new tinymce.util.Dispatcher(this);f=t.onContextMenu.add(function(t,f){(!f.ctrlKey||e)&&(r&&t.selection.setRng(r),i._getMenu(t).showMenu(f.clientX||f.pageX,f.clientY||f.pageX),n.add(t.getDoc(),"click",function(n){u(t,n)}),n.cancel(f))});t.onRemove.add(function(){i._menu&&i._menu.removeAll()});t.onMouseDown.add(u);t.onKeyDown.add(u);t.onKeyDown.add(function(t,i){!i.shiftKey||i.ctrlKey||i.altKey||i.keyCode!==121||(n.cancel(i),f(t,i))})},getInfo:function(){return{longname:"Contextmenu",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/contextmenu",version:tinymce.majorVersion+"."+tinymce.minorVersion}},_getMenu:function(n){var u=this,i=u._menu,s=n.selection,f=s.isCollapsed(),e=s.getNode()||n.getBody(),r,o,h;return i&&(i.removeAll(),i.destroy()),o=t.getPos(n.getContentAreaContainer()),h=t.getPos(n.getContainer()),i=n.controlManager.createDropMenu("contextmenu",{offset_x:o.x+n.getParam("contextmenu_offset_x",0),offset_y:o.y+n.getParam("contextmenu_offset_y",0),constrain:1,keyboard_focus:!0}),u._menu=i,i.add({title:"advanced.cut_desc",icon:"cut",cmd:"Cut"}).setDisabled(f),i.add({title:"advanced.copy_desc",icon:"copy",cmd:"Copy"}).setDisabled(f),i.add({title:"advanced.paste_desc",icon:"paste",cmd:"Paste"}),(e.nodeName!="A"||n.dom.getAttrib(e,"name"))&&f||(i.addSeparator(),i.add({title:"advanced.link_desc",icon:"link",cmd:n.plugins.advlink?"mceAdvLink":"mceLink",ui:!0}),i.add({title:"advanced.unlink_desc",icon:"unlink",cmd:"UnLink"})),i.addSeparator(),i.add({title:"advanced.image_desc",icon:"image",cmd:n.plugins.advimage?"mceAdvImage":"mceImage",ui:!0}),i.addSeparator(),r=i.addMenu({title:"contextmenu.align"}),r.add({title:"contextmenu.left",icon:"justifyleft",cmd:"JustifyLeft"}),r.add({title:"contextmenu.center",icon:"justifycenter",cmd:"JustifyCenter"}),r.add({title:"contextmenu.right",icon:"justifyright",cmd:"JustifyRight"}),r.add({title:"contextmenu.full",icon:"justifyfull",cmd:"JustifyFull"}),u.onContextMenu.dispatch(u,i,e,f),i}});tinymce.PluginManager.add("contextmenu",tinymce.plugins.ContextMenu)})();