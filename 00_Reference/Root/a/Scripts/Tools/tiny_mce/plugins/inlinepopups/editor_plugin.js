(function(){var n=tinymce.DOM,i=tinymce.dom.Element,t=tinymce.dom.Event,r=tinymce.each,u=tinymce.is;tinymce.create("tinymce.plugins.InlinePopups",{init:function(t,i){t.onBeforeRenderUI.add(function(){t.windowManager=new tinymce.InlineWindowManager(t);n.loadCSS(i+"/skins/"+(t.settings.inlinepopups_skin||"clearlooks2")+"/window.css")})},getInfo:function(){return{longname:"InlinePopups",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/inlinepopups",version:tinymce.majorVersion+"."+tinymce.minorVersion}}});tinymce.create("tinymce.InlineWindowManager:tinymce.WindowManager",{InlineWindowManager:function(n){var t=this;t.parent(n);t.zIndex=3e5;t.count=0;t.windows={}},open:function(r,u){var e=this,f,s="",v=e.editor,l=0,a=0,o,p,w,y,h,c;if(r=r||{},u=u||{},!r.inline)return e.parent(r,u);c=e._frontWindow();c&&n.get(c.id+"_ifr")&&(c.focussedElement=n.get(c.id+"_ifr").contentWindow.document.activeElement);r.type||(e.bookmark=v.selection.getBookmark(1));f=n.uniqueId();o=n.getViewPort();r.width=parseInt(r.width||320);r.height=parseInt(r.height||240)+(tinymce.isIE?8:0);r.min_width=parseInt(r.min_width||150);r.min_height=parseInt(r.min_height||100);r.max_width=parseInt(r.max_width||2e3);r.max_height=parseInt(r.max_height||2e3);r.left=r.left||Math.round(Math.max(o.x,o.x+o.w/2-r.width/2));r.top=r.top||Math.round(Math.max(o.y,o.y+o.h/2-r.height/2));r.movable=r.resizable=!0;u.mce_width=r.width;u.mce_height=r.height;u.mce_inline=!0;u.mce_window_id=f;u.mce_auto_focus=r.auto_focus;e.features=r;e.params=u;e.onOpen.dispatch(e,r,u);r.type&&(s+=" mceModal",r.type&&(s+=" mce"+r.type.substring(0,1).toUpperCase()+r.type.substring(1)),r.resizable=!1);r.statusbar&&(s+=" mceStatusbar");r.resizable&&(s+=" mceResizable");r.minimizable&&(s+=" mceMinimizable");r.maximizable&&(s+=" mceMaximizable");r.movable&&(s+=" mceMovable");e._addAll(n.doc.body,["div",{id:f,role:"dialog","aria-labelledby":r.type?f+"_content":f+"_title","class":(v.settings.inlinepopups_skin||"clearlooks2")+(tinymce.isIE&&window.getSelection?" ie9":""),style:"width:100px;height:100px"},["div",{id:f+"_wrapper","class":"mceWrapper"+s},["div",{id:f+"_top","class":"mceTop"},["div",{"class":"mceLeft"}],["div",{"class":"mceCenter"}],["div",{"class":"mceRight"}],["span",{id:f+"_title"},r.title||""]],["div",{id:f+"_middle","class":"mceMiddle"},["div",{id:f+"_left","class":"mceLeft",tabindex:"0"}],["span",{id:f+"_content"}],["div",{id:f+"_right","class":"mceRight",tabindex:"0"}]],["div",{id:f+"_bottom","class":"mceBottom"},["div",{"class":"mceLeft"}],["div",{"class":"mceCenter"}],["div",{"class":"mceRight"}],["span",{id:f+"_status"},"Content"]],["a",{"class":"mceMove",tabindex:"-1",href:"javascript:;"}],["a",{"class":"mceMin",tabindex:"-1",href:"javascript:;",onmousedown:"return false;"}],["a",{"class":"mceMax",tabindex:"-1",href:"javascript:;",onmousedown:"return false;"}],["a",{"class":"mceMed",tabindex:"-1",href:"javascript:;",onmousedown:"return false;"}],["a",{"class":"mceClose",tabindex:"-1",href:"javascript:;",onmousedown:"return false;"}],["a",{id:f+"_resize_n","class":"mceResize mceResizeN",tabindex:"-1",href:"javascript:;"}],["a",{id:f+"_resize_s","class":"mceResize mceResizeS",tabindex:"-1",href:"javascript:;"}],["a",{id:f+"_resize_w","class":"mceResize mceResizeW",tabindex:"-1",href:"javascript:;"}],["a",{id:f+"_resize_e","class":"mceResize mceResizeE",tabindex:"-1",href:"javascript:;"}],["a",{id:f+"_resize_nw","class":"mceResize mceResizeNW",tabindex:"-1",href:"javascript:;"}],["a",{id:f+"_resize_ne","class":"mceResize mceResizeNE",tabindex:"-1",href:"javascript:;"}],["a",{id:f+"_resize_sw","class":"mceResize mceResizeSW",tabindex:"-1",href:"javascript:;"}],["a",{id:f+"_resize_se","class":"mceResize mceResizeSE",tabindex:"-1",href:"javascript:;"}]]]);n.setStyles(f,{top:-1e4,left:-1e4});tinymce.isGecko&&n.setStyle(f,"overflow","auto");r.type||(l+=n.get(f+"_left").clientWidth,l+=n.get(f+"_right").clientWidth,a+=n.get(f+"_top").clientHeight,a+=n.get(f+"_bottom").clientHeight);n.setStyles(f,{top:r.top,left:r.left,width:r.width+l,height:r.height+a});h=r.url||r.file;h&&(tinymce.relaxedDomain&&(h+=(h.indexOf("?")==-1?"?":"&")+"mce_rdomain="+tinymce.relaxedDomain),h=tinymce._addVer(h));r.type?(n.add(f+"_wrapper","a",{id:f+"_ok","class":"mceButton mceOk",href:"javascript:;",onmousedown:"return false;"},"Ok"),r.type=="confirm"&&n.add(f+"_wrapper","a",{"class":"mceButton mceCancel",href:"javascript:;",onmousedown:"return false;"},"Cancel"),n.add(f+"_middle","div",{"class":"mceIcon"}),n.setHTML(f+"_content",r.content.replace("\n","<br />")),t.add(f,"keyup",function(n){if(n.keyCode===27)return r.button_func(!1),t.cancel(n)}),t.add(f,"keydown",function(i){var r;if(i.keyCode===9)return r=n.select("a.mceCancel",f+"_wrapper")[0],r&&r!==i.target?r.focus():n.get(f+"_ok").focus(),t.cancel(i)})):(n.add(f+"_content","iframe",{id:f+"_ifr",src:'javascript:""',frameBorder:0,style:"border:0;width:10px;height:10px"}),n.setStyles(f+"_ifr",{width:r.width,height:r.height}),n.setAttrib(f+"_ifr","src",h));p=t.add(f,"mousedown",function(t){var u=t.target,i,r;if(i=e.windows[f],e.focus(f),u.nodeName=="A"||u.nodeName=="a")if(u.className=="mceMax")i.oldPos=i.element.getXY(),i.oldSize=i.element.getSize(),r=n.getViewPort(),r.w-=2,r.h-=2,i.element.moveTo(r.x,r.y),i.element.resizeTo(r.w,r.h),n.setStyles(f+"_ifr",{width:r.w-i.deltaWidth,height:r.h-i.deltaHeight}),n.addClass(f+"_wrapper","mceMaximized");else if(u.className=="mceMed")i.element.moveTo(i.oldPos.x,i.oldPos.y),i.element.resizeTo(i.oldSize.w,i.oldSize.h),i.iframeElement.resizeTo(i.oldSize.w-i.deltaWidth,i.oldSize.h-i.deltaHeight),n.removeClass(f+"_wrapper","mceMaximized");else{if(u.className=="mceMove")return e._startDrag(f,t,u.className);if(n.hasClass(u,"mceResize"))return e._startDrag(f,t,u.className.substring(13))}});w=t.add(f,"click",function(n){var i=n.target;if(e.focus(f),i.nodeName=="A"||i.nodeName=="a")switch(i.className){case"mceClose":return e.close(null,f),t.cancel(n);case"mceButton mceOk":case"mceButton mceCancel":return r.button_func(i.className=="mceButton mceOk"),t.cancel(n)}});t.add([f+"_left",f+"_right"],"focus",function(t){var r=n.get(f+"_ifr"),u,i;r?(u=r.contentWindow.document.body,i=n.select(":input:enabled,*[tabindex=0]",u),t.target.id===f+"_left"?i[i.length-1].focus():i[0].focus()):n.get(f+"_ok").focus()});y=e.windows[f]={id:f,mousedown_func:p,click_func:w,element:new i(f,{blocker:1,container:v.getContainer()}),iframeElement:new i(f+"_ifr"),features:r,deltaWidth:l,deltaHeight:a};y.iframeElement.on("focus",function(){e.focus(f)});return e.count==0&&e.editor.getParam("dialog_type","modal")=="modal"?(n.add(n.doc.body,"div",{id:"mceModalBlocker","class":(e.editor.settings.inlinepopups_skin||"clearlooks2")+"_modalBlocker",style:{zIndex:e.zIndex-1}}),n.show("mceModalBlocker"),n.setAttrib(n.doc.body,"aria-hidden","true")):n.setStyle("mceModalBlocker","z-index",e.zIndex-1),(tinymce.isIE6||/Firefox\/2\./.test(navigator.userAgent)||tinymce.isIE&&!n.boxModel)&&n.setStyles("mceModalBlocker",{position:"absolute",left:o.x,top:o.y,width:o.w-2,height:o.h-2}),n.setAttrib(f,"aria-hidden","false"),e.focus(f),e._fixIELayout(f,1),n.get(f+"_ok")&&n.get(f+"_ok").focus(),e.count++,y},focus:function(t){var r=this,i;(i=r.windows[t])&&(i.zIndex=this.zIndex++,i.element.setStyle("zIndex",i.zIndex),i.element.update(),t=t+"_wrapper",n.removeClass(r.lastId,"mceFocus"),n.addClass(t,"mceFocus"),r.lastId=t,i.focussedElement?i.focussedElement.focus():n.get(t+"_ok")?n.get(i.id+"_ok").focus():n.get(i.id+"_ifr")&&n.get(i.id+"_ifr").focus())},_addAll:function(n,t){var i,f=this,r=tinymce.DOM;if(u(t,"string"))n.appendChild(r.doc.createTextNode(t));else if(t.length)for(n=n.appendChild(r.create(t[0],t[1])),i=2;i<t.length;i++)f._addAll(n,t[i])},_startDrag:function(r,u,f){function ft(){v||(b._fixIELayout(r,0),n.add(k.body,"div",{id:"mceEventBlocker","class":"mceEventBlocker "+(b.editor.settings.inlinepopups_skin||"clearlooks2"),style:{zIndex:b.zIndex+1}}),(tinymce.isIE6||tinymce.isIE&&!n.boxModel)&&n.setStyles("mceEventBlocker",{position:"absolute",left:e.x,top:e.y,width:e.w-2,height:e.h-2}),v=new i("mceEventBlocker"),v.update(),d=y.getXY(),h=y.getSize(),p=nt.x+d.x-e.x,w=nt.y+d.y-e.y,n.add(v.get(),"div",{id:"mcePlaceHolder","class":"mcePlaceHolder",style:{left:p,top:w,width:h.w,height:h.h}}),g=new i("mcePlaceHolder"))}var b=this,tt,it,k=n.doc,v,a=b.windows[r],y=a.element,et=y.getXY(),d,h,g,nt,e,p,w,rt,ut,o,c,s,l;return nt={x:0,y:0},e=n.getViewPort(),e.w-=2,e.h-=2,rt=u.screenX,ut=u.screenY,o=c=s=l=0,tt=t.add(k,"mouseup",function(i){return t.remove(k,"mouseup",tt),t.remove(k,"mousemove",it),v&&v.remove(),y.moveBy(o,c),y.resizeBy(s,l),h=y.getSize(),n.setStyles(r+"_ifr",{width:h.w-a.deltaWidth,height:h.h-a.deltaHeight}),b._fixIELayout(r,1),t.cancel(i)}),f!="Move"&&ft(),it=t.add(k,"mousemove",function(n){var i,u,r;ft();i=n.screenX-rt;u=n.screenY-ut;switch(f){case"ResizeW":o=i;s=0-i;break;case"ResizeE":s=i;break;case"ResizeN":case"ResizeNW":case"ResizeNE":f=="ResizeNW"?(o=i,s=0-i):f=="ResizeNE"&&(s=i);c=u;l=0-u;break;case"ResizeS":case"ResizeSW":case"ResizeSE":f=="ResizeSW"?(o=i,s=0-i):f=="ResizeSE"&&(s=i);l=u;break;case"mceMove":o=i;c=u}return s<(r=a.features.min_width-h.w)&&(o!==0&&(o+=s-r),s=r),l<(r=a.features.min_height-h.h)&&(c!==0&&(c+=l-r),l=r),s=Math.min(s,a.features.max_width-h.w),l=Math.min(l,a.features.max_height-h.h),o=Math.max(o,e.x-(p+e.x)),c=Math.max(c,e.y-(w+e.y)),o=Math.min(o,e.w+e.x-(p+h.w+e.x)),c=Math.min(c,e.h+e.y-(w+h.h+e.y)),o+c!==0&&(p+o<0&&(o=0),w+c<0&&(c=0),g.moveTo(p+o,w+c)),s+l!==0&&g.resizeTo(h.w+s,h.h+l),t.cancel(n)}),t.cancel(u)},resizeBy:function(n,t,i){var r=this.windows[i];r&&(r.element.resizeBy(n,t),r.iframeElement.resizeBy(n,t))},close:function(i,r){var u=this,f,o=n.doc,e,r;if(r=u._findId(r||i),!u.windows[r]){u.parent(i);return}u.count--;u.count==0&&(n.remove("mceModalBlocker"),n.setAttrib(n.doc.body,"aria-hidden","false"),u.editor.focus());(f=u.windows[r])&&(u.onClose.dispatch(u),t.remove(o,"mousedown",f.mousedownFunc),t.remove(o,"click",f.clickFunc),t.clear(r),t.clear(r+"_ifr"),n.setAttrib(r+"_ifr","src",'javascript:""'),f.element.remove(),delete u.windows[r],e=u._frontWindow(),e&&u.focus(e.id))},_frontWindow:function(){var n,t=0;return r(this.windows,function(i){i.zIndex>t&&(n=i,t=i.zIndex)}),n},setTitle:function(t,i){var r;t=this._findId(t);(r=n.get(t+"_title"))&&(r.innerHTML=n.encode(i))},alert:function(t,i){var r=this,u;u=r.open({title:r,type:"alert",button_func:function(n){i&&i.call(n||r,n);r.close(null,u.id)},content:n.encode(r.editor.getLang(t,t)),inline:1,width:400,height:130})},confirm:function(t,i){var r=this,u;u=r.open({title:r,type:"confirm",button_func:function(n){i&&i.call(n||r,n);r.close(null,u.id)},content:n.encode(r.editor.getLang(t,t)),inline:1,width:400,height:130})},_findId:function(t){var i=this;return typeof t=="string"?t:(r(i.windows,function(i){var r=n.get(i.id+"_ifr");if(r&&t==r.contentWindow)return t=i.id,!1}),t)},_fixIELayout:function(t,i){var u,f;tinymce.isIE6&&(r(["n","s","w","e","nw","ne","sw","se"],function(r){var u=n.get(t+"_resize_"+r);n.setStyles(u,{width:i?u.clientWidth:"",height:i?u.clientHeight:"",cursor:n.getStyle(u,"cursor",1)});n.setStyle(t+"_bottom","bottom","-1px");u=0}),(u=this.windows[t])&&(u.element.hide(),u.element.show(),r(n.select("div,a",t),function(n){n.currentStyle.backgroundImage!="none"&&(f=new Image,f.src=n.currentStyle.backgroundImage.replace(/url\(\"(.+)\"\)/,"$1"))}),n.get(t).style.filter=""))}});tinymce.PluginManager.add("inlinepopups",tinymce.plugins.InlinePopups)})();