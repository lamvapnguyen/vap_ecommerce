(function(){var t=tinymce.each;tinymce.create("tinymce.plugins.TemplatePlugin",{init:function(n,i){var r=this;r.editor=n;n.addCommand("mceTemplate",function(){n.windowManager.open({file:i+"/template.htm",width:n.getParam("template_popup_width",750),height:n.getParam("template_popup_height",600),inline:1},{plugin_url:i})});n.addCommand("mceInsertTemplate",r._insertTemplate,r);n.addButton("template",{title:"template.desc",cmd:"mceTemplate"});n.onPreProcess.add(function(n,i){var u=n.dom;t(u.select("div",i.node),function(i){u.hasClass(i,"mceTmpl")&&(t(u.select("*",i),function(t){u.hasClass(t,n.getParam("template_mdate_classes","mdate").replace(/\s+/g,"|"))&&(t.innerHTML=r._getDateTime(new Date,n.getParam("template_mdate_format",n.getLang("template.mdate_format"))))}),r._replaceVals(i))})})},getInfo:function(){return{longname:"Template plugin",author:"Moxiecode Systems AB",authorurl:"http://www.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/template",version:tinymce.majorVersion+"."+tinymce.minorVersion}},_insertTemplate:function(i,r){function h(n,t){return new RegExp("\\b"+t+"\\b","g").test(n.className)}var e=this,u=e.editor,o,f,s=u.dom,c=u.selection.getContent();o=r.content;t(e.editor.getParam("template_replace_values"),function(n,t){typeof n!="function"&&(o=o.replace(new RegExp("\\{\\$"+t+"\\}","g"),n))});f=s.create("div",null,o);n=s.select(".mceTmpl",f);n&&n.length>0&&(f=s.create("div",null),f.appendChild(n[0].cloneNode(!0)));t(s.select("*",f),function(n){h(n,u.getParam("template_cdate_classes","cdate").replace(/\s+/g,"|"))&&(n.innerHTML=e._getDateTime(new Date,u.getParam("template_cdate_format",u.getLang("template.cdate_format"))));h(n,u.getParam("template_mdate_classes","mdate").replace(/\s+/g,"|"))&&(n.innerHTML=e._getDateTime(new Date,u.getParam("template_mdate_format",u.getLang("template.mdate_format"))));h(n,u.getParam("template_selected_content_classes","selcontent").replace(/\s+/g,"|"))&&(n.innerHTML=c)});e._replaceVals(f);u.execCommand("mceInsertContent",!1,f.innerHTML);u.addVisual()},_replaceVals:function(n){var r=this.editor.dom,i=this.editor.getParam("template_replace_values");t(r.select("*",n),function(n){t(i,function(t,u){r.hasClass(n,u)&&typeof i[u]=="function"&&i[u](n)})})},_getDateTime:function(n,t){function i(n,t){var i;if(n=""+n,n.length<t)for(i=0;i<t-n.length;i++)n="0"+n;return n}return t?(t=t.replace("%D","%m/%d/%y"),t=t.replace("%r","%I:%M:%S %p"),t=t.replace("%Y",""+n.getFullYear()),t=t.replace("%y",""+n.getYear()),t=t.replace("%m",i(n.getMonth()+1,2)),t=t.replace("%d",i(n.getDate(),2)),t=t.replace("%H",""+i(n.getHours(),2)),t=t.replace("%M",""+i(n.getMinutes(),2)),t=t.replace("%S",""+i(n.getSeconds(),2)),t=t.replace("%I",""+((n.getHours()+11)%12+1)),t=t.replace("%p",""+(n.getHours()<12?"AM":"PM")),t=t.replace("%B",""+this.editor.getLang("template_months_long").split(",")[n.getMonth()]),t=t.replace("%b",""+this.editor.getLang("template_months_short").split(",")[n.getMonth()]),t=t.replace("%A",""+this.editor.getLang("template_day_long").split(",")[n.getDay()]),t=t.replace("%a",""+this.editor.getLang("template_day_short").split(",")[n.getDay()]),t.replace("%%","%")):""}});tinymce.PluginManager.add("template",tinymce.plugins.TemplatePlugin)})();