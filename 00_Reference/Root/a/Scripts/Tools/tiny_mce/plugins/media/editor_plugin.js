(function(){function e(n){var i,t;if(n&&!n.splice){for(i=[],t=0;;t++)if(n[t])i[t]=n[t];else break;return i}return n}var t=tinymce.explode("id,name,width,height,style,align,class,hspace,vspace,bgcolor,type"),f=tinymce.makeMap(t.join(",")),n=tinymce.html.Node,r,u,i=tinymce.util.JSON;r=[["Flash","d27cdb6e-ae6d-11cf-96b8-444553540000","application/x-shockwave-flash","http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0"],["ShockWave","166b1bca-3f9c-11cf-8075-444553540000","application/x-director","http://download.macromedia.com/pub/shockwave/cabs/director/sw.cab#version=8,5,1,0"],["WindowsMedia","6bf52a52-394a-11d3-b153-00c04f79faa6,22d6f312-b0f6-11d0-94ab-0080c74c7e95,05589fa1-c356-11ce-bf01-00aa0055595a","application/x-mplayer2","http://activex.microsoft.com/activex/controls/mplayer/en/nsmp2inf.cab#Version=5,1,52,701"],["QuickTime","02bf25d5-8c17-4b23-bc80-d3488abddc6b","video/quicktime","http://www.apple.com/qtactivex/qtplugin.cab#version=6,0,2,0"],["RealMedia","cfcdaa03-8be4-11cf-b84b-0020afbbccfa","audio/x-pn-realaudio-plugin","http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0"],["Java","8ad9c840-044e-11d1-b3e9-00805f499d93","application/x-java-applet","http://java.sun.com/products/plugin/autodl/jinstall-1_5_0-windows-i586.cab#Version=1,5,0,0"],["Silverlight","dfeaf541-f3e1-4c24-acac-99c30715084a","application/x-silverlight-2"],["Iframe"],["Video"]];tinymce.create("tinymce.plugins.MediaPlugin",{init:function(n,f){function a(t){return t&&t.nodeName==="IMG"&&n.dom.hasClass(t,"mceItemMedia")}var c=this,s={},h,o,e,l;for(c.editor=n,c.url=f,u="",h=0;h<r.length;h++){for(l=r[h][0],e={name:l,clsids:tinymce.explode(r[h][1]||""),mimes:tinymce.explode(r[h][2]||""),codebase:r[h][3]},o=0;o<e.clsids.length;o++)s["clsid:"+e.clsids[o]]=e;for(o=0;o<e.mimes.length;o++)s[e.mimes[o]]=e;s["mceItem"+l]=e;s[l.toLowerCase()]=e;u+=(u?"|":"")+l}tinymce.each(n.getParam("media_types","video=mp4,m4v,ogv,webm;silverlight=xap;flash=swf,flv;shockwave=dcr;quicktime=mov,qt,mpg,mp3,mpeg;shockwave=dcr;windowsmedia=avi,wmv,wm,asf,asx,wmx,wvx;realmedia=rm,ra,ram;java=jar").split(";"),function(n){var t,i,r;for(n=n.split(/=/),i=tinymce.explode(n[1].toLowerCase()),t=0;t<i.length;t++)r=s[n[0].toLowerCase()],r&&(s[i[t]]=r)});u=new RegExp("write("+u+")\\(([^)]+)\\)");c.lookup=s;n.onPreInit.add(function(){n.schema.addValidElements("object[id|style|width|height|classid|codebase|*],param[name|value],embed[id|style|width|height|type|src|*],video[*],audio[*],source[*]");n.parser.addNodeFilter("object,embed,video,audio,script,iframe",function(n){for(var t=n.length;t--;)c.objectToImg(n[t])});n.serializer.addNodeFilter("img",function(n,t,i){for(var u=n.length,r;u--;)r=n[u],(r.attr("class")||"").indexOf("mceItemMedia")!==-1&&c.imgToObject(r,i)})});n.onInit.add(function(){n.theme&&n.theme.onResolveName&&n.theme.onResolveName.add(function(t,i){i.name==="img"&&n.dom.hasClass(i.node,"mceItemMedia")&&(i.name="media")});n&&n.plugins.contextmenu&&n.plugins.contextmenu.onContextMenu.add(function(n,t,i){i.nodeName==="IMG"&&i.className.indexOf("mceItemMedia")!==-1&&t.add({title:"media.edit",icon:"media",cmd:"mceMedia"})});n.settings.content_css!==!1&&n.dom.loadCSS(f+"/css/content.css")});n.addCommand("mceMedia",function(){var r,u;u=n.selection.getNode();a(u)&&(r=i.parse(n.dom.getAttrib(u,"data-mce-json")),tinymce.each(t,function(t){var i=n.dom.getAttrib(u,t);i&&(r[t]=i)}),r.type=c.getType(u.className).name.toLowerCase());r||(r={type:"flash",video:{sources:[]},params:{}});n.windowManager.open({file:f+"/media.htm",width:430+parseInt(n.getLang("media.delta_width",0)),height:480+parseInt(n.getLang("media.delta_height",0)),inline:1},{plugin_url:f,data:r})});n.addButton("media",{title:"media.desc",cmd:"mceMedia"});n.onNodeChange.add(function(n,t,i){t.setActive("media",a(i))})},convertUrl:function(n,t){var i=this,r=i.editor,u=r.settings,f=u.url_converter,e=u.url_converter_scope||i;return n?t?r.documentBaseURI.toAbsolute(n):f.call(e,n,"src","object"):n},getInfo:function(){return{longname:"Media",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/media",version:tinymce.majorVersion+"."+tinymce.minorVersion}},dataToImg:function(n,t){var r=this,h=r.editor,c=h.documentBaseURI,f,u,s,o;if(n.params.src=r.convertUrl(n.params.src,t),u=n.video.attrs,u&&(u.src=r.convertUrl(u.src,t)),u&&(u.poster=r.convertUrl(u.poster,t)),f=e(n.video.sources),f)for(o=0;o<f.length;o++)f[o].src=r.convertUrl(f[o].src,t);return s=r.editor.dom.create("img",{id:n.id,style:n.style,align:n.align,src:r.editor.theme.url+"/img/trans.gif","class":"mceItemMedia mceItem"+r.getType(n.type).name,"data-mce-json":i.serialize(n,"'")}),s.width=n.width||"320",s.height=n.height||"240",s},dataToHtml:function(n,t){return this.editor.serializer.serialize(this.dataToImg(n,t),{force_absolute:t})},htmlToData:function(n){var f,r,u;return u={type:"flash",video:{sources:[]},params:{}},f=this.editor.parser.parse(n),r=f.getAll("img")[0],r&&(u=i.parse(r.attr("data-mce-json")),u.type=this.getType(r.attr("class")).name.toLowerCase(),tinymce.each(t,function(n){var t=r.attr(n);t&&(u[n]=t)})),u},getType:function(n){for(var r,i=tinymce.explode(n," "),t=0;t<i.length;t++)if(r=this.lookup[i[t]],r)return r},imgToObject:function(r,u){function nt(n,t,i,r){var e,u,o={width:i,height:r,autostart:!1,repeat:!1,backcolor:"111111",frontcolor:"cccccc",lightcolor:"66cc00",stretching:"fill",enablejs:!1,mute:!1,bufferlength:5,file:n,image:"",skin:"/Scripts/AV/images/skins/default.swf"},s=window.parent.$.param(o);e=p.documentBaseURI;f.params.src="/Scripts/AV/images/flv_player.swf";f.params.flashvars=s;u=p.getParam("flash_video_player_params",{allowfullscreen:!0,allowscriptaccess:!0,wmode:"transparent"});tinymce.each(u,function(n,t){f.params[t]=""+n})}var k=this,p=k.editor,a,h,y,s,o,f,w,b,c,v,l,d=this.editor.settings.width,g=this.editor.settings.height;if(f=i.parse(r.attr("data-mce-json")),c=this.getType(r.attr("class")),l=r.attr("data-mce-style"),l||(l=r.attr("style"),l&&(l=p.dom.serializeStyle(p.dom.parseStyle(l,"img")))),c.name==="Iframe"){v=new n("iframe",1);tinymce.each(t,function(n){var t=r.attr(n);n=="class"&&t&&(t=t.replace(/mceItem.+ ?/g,""));t&&t.length>0&&v.attr(n,t)});for(s in f.params)v.attr(s,f.params[s]);v.attr({style:l,src:f.params.src});r.replace(v);return}if(this.editor.settings.media_use_script){v=new n("script",1).attr("type","text/javascript");o=new n("#text",3);o.value="write"+c.name+"("+i.serialize(tinymce.extend(f.params,{width:r.attr("width"),height:r.attr("height")}))+");";v.append(o);r.replace(v);return}if(c.name==="Video"&&f.video.sources[0]&&(a=new n("video",1).attr(tinymce.extend({id:r.attr("id"),width:r.attr("width"),height:r.attr("height"),controls:"control",style:l},f.video.attrs)),w=f.video.sources=e(f.video.sources),w[0].type||(a.attr("src",w[0].src),w.splice(0,1))),f.params.src){/\.flv$/i.test(f.params.src)&&nt(f.params.src,"",d,g);u&&u.force_absolute&&(f.params.src=p.documentBaseURI.toAbsolute(f.params.src));h=new n("object",1).attr({id:r.attr("id"),width:r.attr("width"),height:r.attr("height"),style:l});tinymce.each(t,function(n){f[n]&&n!="type"&&h.attr(n,f[n])});for(s in f.params)b=new n("param",1),b.shortEnded=!0,o=f.params[s],s==="src"&&c.name==="WindowsMedia"&&(s="url"),b.attr({name:s,value:o}),h.append(b);if(this.editor.getParam("media_strict",!0))h.attr({data:f.params.src,type:c.mimes[0]});else{h.attr({classid:"clsid:"+c.clsids[0],codebase:c.codebase});y=new n("embed",1);y.shortEnded=!0;y.attr({id:r.attr("id"),width:r.attr("width"),height:r.attr("height"),style:l,type:c.mimes[0]});for(s in f.params)y.attr(s,f.params[s]);tinymce.each(t,function(n){f[n]&&n!="type"&&y.attr(n,f[n])});h.append(y)}f.object_html&&(o=new n("#text",3),o.raw=!0,o.value=f.object_html,h.append(o));c.name==="Video"?a.append(""):a&&a.append(h)}a&&f.video_html&&(o=new n("#text",3),o.raw=!0,o.value=f.video_html,a.append(o));a||h?r.replace(a||h):r.remove()},objectToImg:function(r){function st(n){return new tinymce.html.Serializer({inner:!0,validate:!1}).serialize(n)}var s,h,c,l,g,o,w,a,v,b,y,d,ft,et,k,ot,e,p,tt=this.lookup,it,nt,rt=this.editor.settings.url_converter,ut=this.editor.settings.url_converter_scope;if(r.parent){if(r.name==="script"){if(r.firstChild&&(it=u.exec(r.firstChild.value)),!it)return;p=it[1];e={video:{},params:i.parse(it[2])};a=e.params.width;v=e.params.height}if(e=e||{video:{},params:{}},g=new n("img",1),g.attr({src:this.editor.theme.url+"/img/trans.gif"}),o=r.name,o==="video"){c=r;s=r.getAll("object")[0];h=r.getAll("embed")[0];a=c.attr("width");v=c.attr("height");w=c.attr("id");e.video={attrs:{},sources:[]};nt=e.video.attrs;for(o in c.attributes.map)nt[o]=c.attributes.map[o];for(k=r.attr("src"),k&&e.video.sources.push({src:rt.call(ut,k,"src","video")}),ot=c.getAll("source"),y=0;y<ot.length;y++)k=ot[y].remove(),e.video.sources.push({src:rt.call(ut,k.attr("src"),"src","source"),type:k.attr("type"),media:k.attr("media")});nt.poster&&(nt.poster=rt.call(ut,nt.poster,"poster","video"))}if(r.name==="object"&&(s=r,h=r.getAll("embed")[0]),r.name==="embed"&&(h=r),r.name==="iframe"&&(l=r,p="Iframe"),s){for(a=a||s.attr("width"),v=v||s.attr("height"),b=b||s.attr("style"),w=w||s.attr("id"),et=s.getAll("param"),y=0;y<et.length;y++)ft=et[y],o=ft.remove().attr("name"),f[o]||(e.params[o]=ft.attr("value"));e.params.src=e.params.src||s.attr("data")}if(h){a=a||h.attr("width");v=v||h.attr("height");b=b||h.attr("style");w=w||h.attr("id");for(o in h.attributes.map)f[o]||e.params[o]||(e.params[o]=h.attributes.map[o])}if(l){a=l.attr("width");v=l.attr("height");b=b||l.attr("style");w=l.attr("id");tinymce.each(t,function(n){g.attr(n,l.attr(n))});for(o in l.attributes.map)f[o]||e.params[o]||(e.params[o]=l.attributes.map[o])}e.params.movie&&(e.params.src=e.params.src||e.params.movie,delete e.params.movie);e.params.src&&(e.params.src=rt.call(ut,e.params.src,"src","object"));c&&(p=tt.video.name);s&&!p&&(p=(tt[(s.attr("clsid")||"").toLowerCase()]||tt[(s.attr("type")||"").toLowerCase()]||{}).name);h&&!p&&(p=(tt[(h.attr("type")||"").toLowerCase()]||{}).name);r.replace(g);h&&h.remove();s&&(d=st(s.remove()),d&&(e.object_html=d));c&&(d=st(c.remove()),d&&(e.video_html=d));g.attr({id:w,"class":"mceItemMedia mceItem"+(p||"Flash"),style:b,width:a||"320",height:v||"240","data-mce-json":i.serialize(e,"'")})}}});tinymce.PluginManager.add("media",tinymce.plugins.MediaPlugin)})();