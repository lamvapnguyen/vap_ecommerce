(function(){tinymce.create("tinymce.plugins.wpEditImage",{init:function(n,t){var i=this;i.url=t;i._createButtons();n.onInit.add(function(n){tinymce.dom.Event.add(n.getBody(),"dragstart",function(t){if(!tinymce.isGecko&&t.target.nodeName=="IMG"&&n.dom.getParent(t.target,"dl.wp-caption"))return tinymce.dom.Event.cancel(t)})});n.onMouseUp.add(function(n,t){tinymce.isWebKit||tinymce.isOpera||(n.dom.getParent(t.target,"div.mceTemp")||n.dom.is(t.target,"div.mceTemp"))&&window.setTimeout(function(){var n=tinyMCE.activeEditor,t=n.selection.getNode(),i=n.dom.getParent(t,"dl.wp-caption");i&&t.width!=parseInt(n.dom.getStyle(i,"width"),10)-10&&(n.dom.setStyle(i,"width",parseInt(t.width,10)+10),n.execCommand("mceRepaint"))},100)});n.onMouseDown.add(function(n,t){var i;t.target.nodeName=="IMG"&&n.dom.getAttrib(t.target,"class").indexOf("mceItem")==-1&&(n.plugins.wpeditimage._showButtons(t.target,"wp_editbtns"),tinymce.isGecko&&(i=n.dom.getParent(t.target,"dl.wp-caption"))&&n.dom.hasClass(i.parentNode,"mceTemp")&&n.selection.select(i.parentNode))});n.onKeyPress.add(function(n,t){var r,u,i;if(t.keyCode==13&&(r=n.dom.getParent(n.selection.getNode(),"DL"))&&n.dom.hasClass(r,"wp-caption"))return i=n.dom.create("p",{},"&nbsp;"),(u=r.parentNode)&&u.nodeName=="DIV"?n.dom.insertAfter(i,u):n.dom.insertAfter(i,r),i.firstChild?n.selection.select(i.firstChild):n.selection.select(i),tinymce.dom.Event.cancel(t),!1});n.onBeforeSetContent.add(function(n,t){t.content=i._do_shcode(t.content)});n.onPostProcess.add(function(n,t){t.get&&(t.content=i._get_shcode(t.content))});n.onInit.add(function(n){tinymce.dom.Event.add(n.getWin(),"scroll",function(){n.plugins.wpeditimage._hideButtons()});tinymce.dom.Event.add(n.getBody(),"dragstart",function(){n.plugins.wpeditimage._hideButtons()});$("#Content_Body").scroll(function(){n.plugins.wpeditimage._hideButtons()})});n.onBeforeExecCommand.add(function(n){n.plugins.wpeditimage._hideButtons()});n.onSaveContent.add(function(n){n.plugins.wpeditimage._hideButtons()});n.onMouseDown.add(function(n,t){t.target.nodeName!="IMG"&&n.plugins.wpeditimage._hideButtons()})},_do_shcode:function(n){return n.replace(/\[(?:wp_)?caption([^\]]+)\]([\s\S]+?)\[\/(?:wp_)?caption\][\s\u00a0]*/g,function(n,t,i){var e,r,u,f,o;return(t=t.replace(/\\'|\\&#39;|\\&#039;/g,"&#39;").replace(/\\"|\\&quot;/g,"&quot;"),i=i.replace(/\\&#39;|\\&#039;/g,"&#39;").replace(/\\&quot;/g,"&quot;"),e=t.match(/id=['"]([^'"]+)/i),r=t.match(/align=['"]([^'"]+)/i),u=t.match(/width=['"]([0-9]+)/),f=t.match(/caption=['"]([^'"]+)/i),e=e&&e[1]?e[1]:"",r=r&&r[1]?r[1]:"alignnone",u=u&&u[1]?u[1]:"",f=f&&f[1]?f[1]:"",!u||!f)?i:(o=r=="aligncenter"?"mceTemp mceIEcenter":"mceTemp",'<div class="'+o+'" draggable><dl id="'+e+'" class="wp-caption '+r+'" style="width: '+(10+parseInt(u))+'px"><dt class="wp-caption-dt">'+i+'<\/dt><dd class="wp-caption-dd">'+f+"<\/dd><\/dl><\/div>")})},_get_shcode:function(n){return n.replace(/<div class="mceTemp[^"]*">\s*<dl([^>]+)>\s*<dt[^>]+>([\s\S]+?)<\/dt>\s*<dd[^>]+>(.+?)<\/dd>\s*<\/dl>\s*<\/div>\s*/gi,function(n,t,i,r){var e,u,f;return(e=t.match(/id=['"]([^'"]+)/i),u=t.match(/class=['"]([^'"]+)/i),f=i.match(/width=['"]([0-9]+)/),e=e&&e[1]?e[1]:"",u=u&&u[1]?u[1]:"alignnone",f=f&&f[1]?f[1]:"",!f||!r)?i:(u=u.match(/align[^ '"]+/)||"alignnone",r=r.replace(/<\S[^<>]*>/gi,"").replace(/'/g,"&#39;").replace(/"/g,"&quot;"),'[caption id="'+e+'" align="'+u+'" width="'+f+'" caption="'+r+'"]'+i+"[/caption]")})},_createButtons:function(){var t=this,u=tinyMCE.activeEditor,n=tinymce.DOM,i,r;n.remove("wp_editbtns");n.add(document.body,"div",{id:"wp_editbtns",style:"display:none;"});i=n.add("wp_editbtns","img",{src:t.url+"/img/image.png",id:"wp_editimgbtn",width:"24",height:"24",title:"Edit Image"});tinymce.dom.Event.add(i,"mousedown",function(){var n=tinyMCE.activeEditor;n.windowManager.bookmark=n.selection.getBookmark("simple");n.execCommand("mceImage")});r=n.add("wp_editbtns","img",{src:t.url+"/img/delete.png",id:"wp_delimgbtn",width:"24",height:"24",title:"Delete Image"});tinymce.dom.Event.add(r,"mousedown",function(){var n=tinyMCE.activeEditor,i=n.selection.getNode(),t;if(i.nodeName=="IMG"&&n.dom.getAttrib(i,"class").indexOf("mceItem")==-1)return(t=n.dom.getParent(i,"div"))&&n.dom.hasClass(t,"mceTemp")?n.dom.remove(t):(t=n.dom.getParent(i,"A"))&&t.childNodes.length==1?n.dom.remove(t):n.dom.remove(i),n.execCommand("mceRepaint"),!1})},mceTout:0,_showButtons:function(n,t){var i=tinyMCE.activeEditor,r,u,f,e=tinymce.DOM,o,s;f=i.dom.getViewPort(i.getWin());r=e.getPos(i.getContentAreaContainer());u=i.dom.getPos(n);o=Math.max(u.x-f.x,0)+r.x;s=Math.max(u.y-f.y,0)+r.y;e.setStyles(t,{top:s+5+"px",left:o+5+"px",display:"block",position:"absolute"});this.mceTout&&clearTimeout(this.mceTout);this.mceTout=setTimeout(function(){i.plugins.wpeditimage._hideButtons()},5e3)},_hideButtons:function(){this.mceTout&&(document.getElementById("wp_editbtns")&&tinymce.DOM.hide("wp_editbtns"),document.getElementById("wp_gallerybtns")&&tinymce.DOM.hide("wp_gallerybtns"),clearTimeout(this.mceTout),this.mceTout=0)},getInfo:function(){return{longname:"Edit Image",author:"WordPress",authorurl:"http://wordpress.org",infourl:"",version:"1.0"}}});tinymce.PluginManager.add("wpeditimage",tinymce.plugins.wpEditImage)})();