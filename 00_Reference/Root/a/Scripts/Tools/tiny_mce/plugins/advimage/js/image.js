var ImageDialog={preInit:function(){var n;tinyMCEPopup.requireLangPack();(n=tinyMCEPopup.getParam("external_image_list_url"))&&document.write('<script language="javascript" type="text/javascript" src="'+tinyMCEPopup.editor.documentBaseURI.toAbsolute(n)+'"><\/script>')},init:function(n){var u=document.forms[0],i=u.elements,n=tinyMCEPopup.editor,r=n.dom,t=n.selection.getNode();tinyMCEPopup.resizeToInnerSize();this.fillClassList("class_list");this.fillFileList("src_list","tinyMCEImageList");this.fillFileList("over_list","tinyMCEImageList");this.fillFileList("out_list","tinyMCEImageList");TinyMCE_EditableSelects.init();t.nodeName=="IMG"&&(i.src.value=r.getAttrib(t,"src"),i.width.value=r.getAttrib(t,"width"),i.height.value=r.getAttrib(t,"height"),i.alt.value=r.getAttrib(t,"alt"),i.title.value=r.getAttrib(t,"title"),i.vspace.value=this.getAttrib(t,"vspace"),i.hspace.value=this.getAttrib(t,"hspace"),i.border.value=this.getAttrib(t,"border"),selectByValue(u,"align",this.getAttrib(t,"align")),selectByValue(u,"class_list",r.getAttrib(t,"class"),!0,!0),i.style.value=r.getAttrib(t,"style"),i.id.value=r.getAttrib(t,"id"),i.dir.value=r.getAttrib(t,"dir"),i.lang.value=r.getAttrib(t,"lang"),i.usemap.value=r.getAttrib(t,"usemap"),i.longdesc.value=r.getAttrib(t,"longdesc"),i.insert.value=n.getLang("update"),/^\s*this.src\s*=\s*\'([^\']+)\';?\s*$/.test(r.getAttrib(t,"onmouseover"))&&(i.onmouseoversrc.value=r.getAttrib(t,"onmouseover").replace(/^\s*this.src\s*=\s*\'([^\']+)\';?\s*$/,"$1")),/^\s*this.src\s*=\s*\'([^\']+)\';?\s*$/.test(r.getAttrib(t,"onmouseout"))&&(i.onmouseoutsrc.value=r.getAttrib(t,"onmouseout").replace(/^\s*this.src\s*=\s*\'([^\']+)\';?\s*$/,"$1")),n.settings.inline_styles&&(r.getAttrib(t,"align")&&this.updateStyle("align"),r.getAttrib(t,"hspace")&&this.updateStyle("hspace"),r.getAttrib(t,"border")&&this.updateStyle("border"),r.getAttrib(t,"vspace")&&this.updateStyle("vspace")));document.getElementById("srcbrowsercontainer").innerHTML=getBrowserHTML("srcbrowser","src","image","theme_advanced_image");isVisible("srcbrowser")&&(document.getElementById("src").style.width="260px");document.getElementById("onmouseoversrccontainer").innerHTML=getBrowserHTML("overbrowser","onmouseoversrc","image","theme_advanced_image");isVisible("overbrowser")&&(document.getElementById("onmouseoversrc").style.width="260px");document.getElementById("onmouseoutsrccontainer").innerHTML=getBrowserHTML("outbrowser","onmouseoutsrc","image","theme_advanced_image");isVisible("outbrowser")&&(document.getElementById("onmouseoutsrc").style.width="260px");n.getParam("advimage_constrain_proportions",!0)&&(u.constrain.checked=!0);i.onmouseoversrc.value||i.onmouseoutsrc.value?this.setSwapImage(!0):this.setSwapImage(!1);this.changeAppearance();this.showPreviewImage(i.src.value,1)},insert:function(){var n=tinyMCEPopup.editor,t=this,i=document.forms[0];if(i.src.value===""){n.selection.getNode().nodeName=="IMG"&&(n.dom.remove(n.selection.getNode()),n.execCommand("mceRepaint"));tinyMCEPopup.close();return}if(tinyMCEPopup.getParam("accessibility_warnings",1)&&!i.alt.value){tinyMCEPopup.confirm(tinyMCEPopup.getLang("advimage_dlg.missing_alt"),function(n){n&&t.insertAndClose()});return}t.insertAndClose()},insertAndClose:function(){var t=tinyMCEPopup.editor,r=document.forms[0],n=r.elements,i={},u;tinyMCEPopup.restoreSelection();tinymce.isWebKit&&t.getWin().focus();i=t.settings.inline_styles?{vspace:"",hspace:"",border:"",align:""}:{vspace:n.vspace.value,hspace:n.hspace.value,border:n.border.value,align:getSelectValue(r,"align")};tinymce.extend(i,{src:n.src.value,width:n.width.value,height:n.height.value,alt:n.alt.value,title:n.title.value,"class":getSelectValue(r,"class_list"),style:n.style.value,id:n.id.value,dir:n.dir.value,lang:n.lang.value,usemap:n.usemap.value,longdesc:n.longdesc.value});i.onmouseover=i.onmouseout="";r.onmousemovecheck.checked&&(n.onmouseoversrc.value&&(i.onmouseover="this.src='"+n.onmouseoversrc.value+"';"),n.onmouseoutsrc.value&&(i.onmouseout="this.src='"+n.onmouseoutsrc.value+"';"));u=t.selection.getNode();u&&u.nodeName=="IMG"?t.dom.setAttribs(u,i):(t.execCommand("mceInsertContent",!1,'<img id="__mce_tmp" />',{skip_undo:1}),t.dom.setAttribs("__mce_tmp",i),t.dom.setAttrib("__mce_tmp","id",""),t.undoManager.add());tinyMCEPopup.close()},getAttrib:function(n,t){var f=tinyMCEPopup.editor,r=f.dom,i,u;if(f.settings.inline_styles)switch(t){case"align":if((i=r.getStyle(n,"float"))||(i=r.getStyle(n,"vertical-align")))return i;break;case"hspace":if(i=r.getStyle(n,"margin-left"),u=r.getStyle(n,"margin-right"),i&&i==u)return parseInt(i.replace(/[^0-9]/g,""));break;case"vspace":if(i=r.getStyle(n,"margin-top"),u=r.getStyle(n,"margin-bottom"),i&&i==u)return parseInt(i.replace(/[^0-9]/g,""));break;case"border":if(i=0,tinymce.each(["top","right","bottom","left"],function(t){if(t=r.getStyle(n,"border-"+t+"-width"),!t||t!=i&&i!==0)return i=0,!1;t&&(i=t)}),i)return parseInt(i.replace(/[^0-9]/g,""))}return(i=r.getAttrib(n,t))?i:""},setSwapImage:function(n){var t=document.forms[0];t.onmousemovecheck.checked=n;setBrowserDisabled("overbrowser",!n);setBrowserDisabled("outbrowser",!n);t.over_list&&(t.over_list.disabled=!n);t.out_list&&(t.out_list.disabled=!n);t.onmouseoversrc.disabled=!n;t.onmouseoutsrc.disabled=!n},fillClassList:function(n){var r=tinyMCEPopup.dom,t=r.get(n),u,i;(u=tinyMCEPopup.getParam("theme_advanced_styles"))?(i=[],tinymce.each(u.split(";"),function(n){var t=n.split("=");i.push({title:t[0],"class":t[1]})})):i=tinyMCEPopup.editor.dom.getClasses();i.length>0?(t.options.length=0,t.options[t.options.length]=new Option(tinyMCEPopup.getLang("not_set"),""),tinymce.each(i,function(n){t.options[t.options.length]=new Option(n.title||n["class"],n["class"])})):r.remove(r.getParent(n,"tr"))},fillFileList:function(n,t){var r=tinyMCEPopup.dom,i=r.get(n);t=window[t];i.options.length=0;t&&t.length>0?(i.options[i.options.length]=new Option("",""),tinymce.each(t,function(n){i.options[i.options.length]=new Option(n[0],n[1])})):r.remove(r.getParent(n,"tr"))},resetImageData:function(){var n=document.forms[0];n.elements.width.value=n.elements.height.value=""},updateImageData:function(n,t){var i=document.forms[0];t||(i.elements.width.value=n.width,i.elements.height.value=n.height);this.preloadImg=n},changeAppearance:function(){var i=tinyMCEPopup.editor,t=document.forms[0],n=document.getElementById("alignSampleImg");n&&(i.getParam("inline_styles")?i.dom.setAttrib(n,"style",t.style.value):(n.align=t.align.value,n.border=t.border.value,n.hspace=t.hspace.value,n.vspace=t.vspace.value))},changeHeight:function(){var n=document.forms[0],i,t=this;n.constrain.checked&&t.preloadImg&&n.width.value!=""&&n.height.value!=""&&(i=parseInt(n.width.value)/parseInt(t.preloadImg.width)*t.preloadImg.height,n.height.value=i.toFixed(0))},changeWidth:function(){var n=document.forms[0],i,t=this;n.constrain.checked&&t.preloadImg&&n.width.value!=""&&n.height.value!=""&&(i=parseInt(n.height.value)/parseInt(t.preloadImg.height)*t.preloadImg.width,n.width.value=i.toFixed(0))},updateStyle:function(n){var r=tinyMCEPopup.dom,t,u=document.forms[0],i=r.create("img",{style:r.get("style").value});tinyMCEPopup.editor.settings.inline_styles&&(n=="align"&&(r.setStyle(i,"float",""),r.setStyle(i,"vertical-align",""),t=getSelectValue(u,"align"),t&&(t=="left"||t=="right"?r.setStyle(i,"float",t):i.style.verticalAlign=t)),n=="border"&&(r.setStyle(i,"border",""),t=u.border.value,(t||t=="0")&&(i.style.border=t=="0"?"0":t+"px solid black")),n=="hspace"&&(r.setStyle(i,"marginLeft",""),r.setStyle(i,"marginRight",""),t=u.hspace.value,t&&(i.style.marginLeft=t+"px",i.style.marginRight=t+"px")),n=="vspace"&&(r.setStyle(i,"marginTop",""),r.setStyle(i,"marginBottom",""),t=u.vspace.value,t&&(i.style.marginTop=t+"px",i.style.marginBottom=t+"px")),r.get("style").value=r.serializeStyle(r.parseStyle(i.style.cssText)))},changeMouseMove:function(){},showPreviewImage:function(n,t){if(!n){tinyMCEPopup.dom.setHTML("prev","");return}!t&&tinyMCEPopup.getParam("advimage_update_dimensions_onchange",!0)&&this.resetImageData();n=tinyMCEPopup.editor.documentBaseURI.toAbsolute(n);t?tinyMCEPopup.dom.setHTML("prev",'<img id="previewImg" src="'+n+'" border="0" onload="ImageDialog.updateImageData(this, 1);" />'):tinyMCEPopup.dom.setHTML("prev",'<img id="previewImg" src="'+n+'" border="0" onload="ImageDialog.updateImageData(this);" onerror="ImageDialog.resetImageData();" />')}};ImageDialog.preInit();tinyMCEPopup.onInit.add(ImageDialog.init,ImageDialog);