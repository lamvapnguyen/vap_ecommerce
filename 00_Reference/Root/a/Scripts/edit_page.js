var __PMMgr={module_list:{},module_group:{},module_has_option:[],active_module:[],admin_module:[],is_sysadmin:!1,init:function(){$(function(){var r,f,u,i;if(__PMMgr.module_list={},__PMMgr.module_group={},__PMMgr._cur_module=null,__PMMgr.active_module=$("#__active_module").val().split(";"),__PMMgr.admin_module=$("#__admin_module").val().split(";"),__PMMgr.is_sysadmin=$("#__is_sysadmin").val()=="True",__PMMgr.module_has_option=$("#__module_has_option").val().split(";"),r=$("#module_page_xml").val(),r!="")for(f=Xml.parse(r).documentElement,u=f.getElementsByTagName("uc"),i=0;i<u.length;i++){var t=u[i],n={},e=t.getAttribute("Name");n.ID=t.getAttribute("ID");n.Name=e;n.Path=t.getAttribute("Path");n.Pos=parseInt(t.getAttribute("Pos"));n.P=t.getAttribute("P");n.A=t.getAttribute("A")=="true";__PMMgr.module_list[e]=n}__PMMgr.init_group()})},init_group:function(){__PMMgr.module_group={};var n="";$("#m_page_editor ul.m_group").each(function(){var t=$(this),i=t.prev().text(),r=t.attr("gname",i).attr("pos");__PMMgr.module_group[r]=t;n+="<option value='"+r+"'>"+i+"<\/option>";t.next().click(function(){__PMMgr._load_module({ID:-1,Pos:t.attr("pos"),Name:"",P:"",A:!0},null)})});$("#edit_module_position").html(n);$.each(__PMMgr.module_list,function(n,t){__PMMgr._add_module(t)})},save:function(){var n=Xml.parse("<controls><\/controls>"),i=n.documentElement,t=function(t){var r=n.createElement("uc");r.setAttribute("ID",t.ID);r.setAttribute("Name",t.Name.replace(" ","_").replace("-","_"));r.setAttribute("Path",t.Path);r.setAttribute("Pos",t.Pos);r.setAttribute("P",t.P);r.setAttribute("A",t.A.toString());i.appendChild(r)};$("#m_page_editor li[title]").each(function(){var n=$(this).attr("title"),i=__PMMgr.module_list[n];i!=null&&(t(i),__PMMgr.module_list[n]=null,delete __PMMgr.module_list[n])});$.each(__PMMgr.module_list,function(n,i){i!=null&&t(i)});$("#module_page_xml").val(Xml.toString(n))},_cur_module:null,_add_module:function(n,t){var u=n.Pos,r=__PMMgr.module_group[u],i;return r?(i=$("<li><input type='checkbox' style='float:left;'><div class='m_group_label'>"+n.Name+"<\/div><div class='m_button_c'>\t\t\t<input type='button' title='Edit' value=' ' class='m_button_edit' >\t\t\t<input type='button' title='Delete' value=' ' class='m_button_del' >\t\t\t<\/div><div class='clear'><\/div><\/li>").attr("title",n.Name),i.dblclick(function(){__PMMgr._load_module(n,i)}),i.children(":first").prop("checked",n.A).click(function(){this.checked=!this.checked;n.A=this.checked}),i.children(":first").change(function(){this.checked=!this.checked;n.A=this.checked}),$.inArray(n.ID,__PMMgr.active_module)==-1)?(r.append(i.hide()),i):!__PMMgr.is_sysadmin&&(n.ID==22||n.ID==34)?(i.find("*").prop("disabled",!0),r.append(i.addClass("module_disabled")),i):!__PMMgr.is_sysadmin&&$.inArray(n.ID,__PMMgr.admin_module)!=-1?(i.click(function(){__PMMgr._cur_module&&__PMMgr._cur_module.removeClass("active");__PMMgr._cur_module=$(this).addClass("active")}).children(":first").prop("disabled",!0),i.children(":last").children(":first").hide().next().hide().next().click(function(){__PMMgr._load_module(n,i)}).next().hide(),r.append(i),i):(i.click(function(){__PMMgr._cur_module&&__PMMgr._cur_module.removeClass("active");__PMMgr._cur_module=$(this).addClass("active")}),i.children(":last").prev().children(":first").click(function(){__PMMgr._load_module(n,i)}).next().click(function(){__showWindow("m_msg_deleteconfirm",function(){i.remove();__PMMgr.module_list[n.Name]=null;__PMMgr._cur_module=null;delete __PMMgr.module_list[n.Name]},null,null,!0)}),r.append(i),t&&i.click(),i):null},_cache_module:{},_change_module:function(n,t){$("#edit_module_prop").html("");$.inArray(n,__PMMgr.module_has_option)!=-1&&($("#edit_module_loading").show(),$.post("ajaxh.axd",{action:"page_module_detail",moduleID:n},function(n){$("#edit_module_loading").hide();n!=""&&($("#edit_module_prop").html(n),__showWindow("m_msg_editmodule"),t&&t())}))},_load_module:function(n,t){$("#edit_module_prop").html("");$("#edit_module_id").unbind().change(function(){this.value==""?$(this).parent().parent().hide():$(this).parent().parent().show();__PMMgr._change_module(this.value||n.ID,function(){var f=/(\w+)=\"([^\"]*)\"/g,i=null,u=$("<div "+n.P+"><\/div>"),r,t;do if(i=f.exec(n.P),i&&(r=$("#p"+i[1]),r.length>0)){switch(r[0].tagName.toLowerCase()){case"input":if(r.attr("type")=="checkbox"){r.prop("checked",i[2]=="true");continue}break;case"textarea":t=i[1];
/*!!! lvtm*/
if(t=="__lvtmxhtml01"||t=="__lvtmxhtml02"||t=="__lvtmxhtml03"||t=="__lvtmxhtml04"||t=="__lvtmxhtml05"){r.val(u.attr(t));load_setting_editor("p"+t);continue}}r.val(u.attr(i[1]))}while(i!=null)})}).val(n.ID);__showWindow("m_msg_editmodule",function(){var i=$("#edit_module_name").val(),e,r,u,f;if(i&&i!=""&&(i==n.Name||__PMMgr.module_list[i]==null))__PMMgr.module_list[n.Name]=null,delete __PMMgr.module_list[n.Name];else return __showWindow("m_msg_nameexists",null,null,null,!0),!1;if(e=$("#edit_module_id"),r=e.val()||n.ID,r==""||r=="-1")return __showWindow("m_msg_pleasechosecontrol",null,null,null,!0),!1;u=$("<div><div><\/div><\/div>").children(":first");$("#edit_module_prop").find("select,textarea,:checkbox,:text,input[type=hidden]").each(function(){var n=$(this),t=n.attr("p");if(t&&t!=""){if(n.attr("type")=="checkbox"){u.attr(t,n.prop("checked"));return}u.attr(t,n.val())}});u.attr("ModuleID",r);f=u.parent().html();f=f.substr(5,f.length-12);n.ID=r;n.Pos=$("#edit_module_position").val();n.Path=$(e[0].options[e[0].selectedIndex]).attr("path")||n.Path;n.Name=i;n.P=f;__PMMgr.module_list[i]=n;t?(t.attr("title",i).children("div:first").text(i),t.parent().attr("pos")!=n.Pos&&__PMMgr.module_group[n.Pos].append(t.detach())):__PMMgr._add_module(n,!0)},null,function(){n.ID!=-1&&$("#edit_module_id").change();$("#edit_module_name").val(n.Name);$("#edit_module_position").val(n.Pos)},!0)}};