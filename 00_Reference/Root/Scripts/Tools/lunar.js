var PI=Math.PI,_cal={calToLunar:function(n,t){$("#"+n+" .calendar_day").each(function(){var u=Math.floor($(this).attr("d")),f=Math.floor($(this).attr("m")),e=Math.floor($(this).attr("y")),n=_cal.convertSolar2Lunar(u,f,e,t),i="",r="";n[1]==1&&(r="/"+n[2]);i=n[0]==1?"<span class='lunar_firstday'>1/"+n[1]+r+"<\/span>":n[0];$(this).next().html(i)})},jdFromDate:function(n,t,i){var f,r,e,u;return f=Math.floor((14-t)/12),r=i+4800-f,e=t+12*f-3,u=n+Math.floor((153*e+2)/5)+365*r+Math.floor(r/4)-Math.floor(r/100)+Math.floor(r/400)-32045,u<2299161&&(u=n+Math.floor((153*e+2)/5)+365*r+Math.floor(r/4)-32083),u},jdToDate:function(n){var u,i,r,f,e,t,o,s,h;return n>2299160?(u=n+32044,i=Math.floor((4*u+3)/146097),r=u-Math.floor(i*146097/4)):(i=0,r=n+32082),f=Math.floor((4*r+3)/1461),e=r-Math.floor(1461*f/4),t=Math.floor((5*e+2)/153),o=e-Math.floor((153*t+2)/5)+1,s=t+3-12*Math.floor(t/10),h=i*100+f-4800+Math.floor(t/10),[o,s,h]},newMoon:function(n){var r,u,o,t,h,e,f,s,i,c;return r=n/1236.85,u=r*r,o=u*r,t=PI/180,h=2415020.75933+29.53058868*n+.0001178*u-155e-9*o,h=h+.00033*Math.sin((166.56+132.87*r-.009173*u)*t),e=359.2242+29.10535608*n-333e-7*u-347e-8*o,f=306.0253+385.81691806*n+.0107306*u+1236e-8*o,s=21.2964+390.67050646*n-.0016528*u-239e-8*o,i=(.1734-.000393*r)*Math.sin(e*t)+.0021*Math.sin(2*t*e),i=i-.4068*Math.sin(f*t)+.0161*Math.sin(t*2*f),i=i-.0004*Math.sin(t*3*f),i=i+.0104*Math.sin(t*2*s)-.0051*Math.sin(t*(e+f)),i=i-.0074*Math.sin(t*(e-f))+.0004*Math.sin(t*(2*s+e)),i=i-.0004*Math.sin(t*(2*s-e))-.0006*Math.sin(t*(2*s+f)),i=i+.001*Math.sin(t*(2*s-f))+.0005*Math.sin(t*(2*f+e)),c=r<-11?.001+.000839*r+.0002261*u-845e-8*o-81e-9*r*o:-.000278+.000265*r+.000262*u,h+i-c},sunLongitude:function(n){var t,i,r,f,o,e,u;return t=(n-2451545)/36525,i=t*t,r=PI/180,f=357.5291+35999.0503*t-.0001559*i-48e-8*t*i,o=280.46645+36000.76983*t+.0003032*i,e=(1.9146-.004817*t-14e-6*i)*Math.sin(r*f),e=e+(.019993-.000101*t)*Math.sin(r*2*f)+.00029*Math.sin(r*3*f),u=o+e,u=u*r,u-PI*2*Math.floor(u/(PI*2))},getSunLongitude:function(n,t){return Math.floor(_cal.sunLongitude(n-.5-t/24)/PI*6)},getNewMoonDay:function(n,t){return Math.floor(_cal.newMoon(n)+.5+t/24)},getLunarMonth11:function(n,t){var r,u,i,f;return u=_cal.jdFromDate(31,12,n)-2415021,r=Math.floor(u/29.530588853),i=_cal.getNewMoonDay(r,t),f=_cal.getSunLongitude(i,t),f>=9&&(i=_cal.getNewMoonDay(r-1,t)),i},getLeapMonthOffset:function(n,t){var u,f,r,i;u=Math.floor((n-2415021.0769986948)/29.530588853+.5);f=0;i=1;r=_cal.getSunLongitude(_cal.getNewMoonDay(u+i,t),t);do f=r,i++,r=_cal.getSunLongitude(_cal.getNewMoonDay(u+i,t),t);while(r!=f&&i<14);return i-1},convertSolar2Lunar:function(n,t,i,r){var h,o,e,u,c,a,f,s,l;return o=_cal.jdFromDate(n,t,i),h=Math.floor((o-2415021.0769986948)/29.530588853),e=_cal.getNewMoonDay(h+1,r),e>o&&(e=_cal.getNewMoonDay(h,r)),u=_cal.getLunarMonth11(i,r),c=u,u>=e?(s=i,u=_cal.getLunarMonth11(i-1,r)):(s=i+1,c=_cal.getLunarMonth11(i+1,r)),a=o-e+1,diff=Math.floor((e-u)/29),l=0,f=diff+11,c-u>365&&(leapMonthDiff=_cal.getLeapMonthOffset(u,r),diff>=leapMonthDiff&&(f=diff+10,diff==leapMonthDiff&&(l=1))),f>12&&(f=f-12),f>=11&&diff<4&&(s-=1),[a,f,s,l]},convertLunar2Solar:function(n,t,i,r,u){var c,e,s,f,h,o,l;if(t<11?(e=_cal.getLunarMonth11(i-1,u),s=_cal.getLunarMonth11(i,u)):(e=_cal.getLunarMonth11(i,u),s=_cal.getLunarMonth11(i+1,u)),c=Math.floor(.5+(e-2415021.0769986948)/29.530588853),f=t-11,f<0&&(f+=12),s-e>365){if(h=_cal.getLeapMonthOffset(e,u),o=h-2,o<0&&(o+=12),r!=0&&t!=o)return[0,0,0];(r!=0||f>=h)&&(f+=1)}return l=_cal.getNewMoonDay(c+f,u),_cal.jdToDate(l+n-1)}};