(function(n){n.fn.piroBox=function(t){function i(){var it=n(document).height(),l=n(jQuery('<div class="piro_overlay"><\/div>').hide().css({opacity:+t.bg_alpha,height:it+"px"})),r=n(jQuery('<table class="pirobox_content" cellpadding="0" cellspacing="0"><\/table>')),o=n(jQuery('<div class="caption"><\/div>')),b=n(jQuery('<div class="piro_nav"><\/div>')),h=n(jQuery('<a href="#close" class="piro_close" title="close"><\/a>')),e=n(jQuery('<a href="#play" class="play" title="play slideshow"><\/a>')),v=n(jQuery('<a href="#stop" class="stop" title="stop slideshow"><\/a>')),u=n(jQuery('<a href="#prev" class="piro_prev" title="previous image"><\/a>')),f=n(jQuery('<a href="#next" class="piro_next" title="next image"><\/a>')),y,a,p,k,c,d,s,rt,ut,g,nt,i,tt,w;for(n("body").append(l).append(r),r.append('<tr><td colspan="3" class="pirobox_up"><\/td><\/tr><tr><td class="t_l"><\/td><td class="t_c"><\/td><td class="t_r"><\/td><\/tr><tr><td class="c_l"><\/td><td class="c_c"><span><span><\/span><\/span><div><\/div><\/td><td class="c_r"><\/td><\/tr><tr><td class="b_l"><\/td><td class="b_c"><\/td><td class="b_r"><\/td><\/tr><tr><td colspan="3" class="pirobox_down"><\/td><\/tr>'),n(".pirobox_up").append(h),n(".pirobox_down").append(b),n(".pirobox_down").append(e),e.hide(),n(".pirobox_down").append(u).append(f),b.append(o),y=u.width(),r.hide(),a=n("a[class^='pirobox']"),p={},s=0;s<a.length;s++)k=n(a[s]),p["a."+k.attr("class")]=0;c=[];for(d in p)c.push(d);for(s=0;s<c.length;s++)n(c[s]).each(function(t){this.rel=t+1+"&nbsp;of&nbsp;"+n(c[s]).length}),rt=n(c[s]+":first").addClass("first"),ut=n(c[s]+":last").addClass("last");n(a).each(function(n){this.rev=n+0});g=n(a).each(function(){this.href});nt=n("body").append('<div id="imgCache" style="display:none"><\/div').children("#imgCache");n.each(g,function(t,i){n("<div/>").css({background:"url("+i+")",width:"600px",height:"200px"}).appendTo(nt)});i=n(a);n.fn.fixPNG=function(){return this.each(function(){var t=n(this).css("backgroundImage");t.match(/^url\(["']?(.*\.png)["']?\)$/i)&&(t=RegExp.$1,n(this).css({backgroundImage:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod="+(n(this).css("backgroundRepeat")=="no-repeat"?"crop":"scale")+", src='"+t+"')"}).each(function(){var t=n(this).css("position");t!="absolute"&&t!="relative"&&n(this).css("position","relative")}))})};n(window).resize(function(){var t=n(document).height();l.css({visibility:"visible",height:+t+"px"})});u.add(f).bind("click",function(t){t.preventDefault();var e=parseInt(n(i).filter(".item").attr("rev")),r=n(this).is(".piro_prev_out,.piro_prev")?n(i).eq(e-1):n(i).eq(e+1);r.size()||(r=n(this).is(".piro_prev_out,.piro_prev")?n(i).eq(n(i).size()-1):n(i).eq(0));r.click();h.add(o).add(f).add(u).css("visibility","hidden")});n(i).each(function(){var t=n(this);t.unbind();t.bind("click",function(r){r.preventDefault();tt(t.attr("href"));var s=t.attr("href"),h=t.attr("title"),c=t.attr("rel");h==""?o.html("<p>"+s+'<em class="number">'+c+"<\/em><a href="+s+' class="link_to" target="_blank" title="Open Image in a new window"><\/a><\/p>'):o.html("<p>"+h+'<em class="number">'+c+"<\/em><a href="+s+' class="link_to" target="_blank" title="Open Image in a new window"><\/a><\/p>');t.is(".last")?n(".number").css("text-decoration","underline"):n(".number").css("text-decoration","none");t.is(".first")?(u.hide(),f.show()):f.add(u).show();t.is(".last")?(u.show(),f.hide(),e.css("width","0")):e.css("width","40px");t.is(".last")&&t.is(".first")&&(u.add(f).hide(),n(".number").hide(),e.remove());n(i).filter(".item").removeClass("item");t.addClass("item");n(".c_c").removeClass("unique")})});tt=function(t){e.add(v).hide();h.add(o).add(f).add(u).css("visibility","hidden");r.is(":visible")?n(".c_c div").children().fadeOut(300,function(){n(".c_c div").children().remove();w(t)}):(n(".c_c div").children().remove(),r.show(),l.fadeIn(300,function(){w(t)}))};w=function(s){var c,p,a;if(!r.is(".loading")&&(r.addClass("loading"),c=new Image,c.onerror=function(){var t=n(r).height();r.css({marginTop:parseInt(n(document).scrollTop())-t/1.9});n(".c_c div").append('<p class="err_mess">There seems to be an Error:&nbsp;<a href="#close" class="close_pirobox">Close Pirobox<\/a><\/p>');n(".close_pirobox").bind("click",function(n){n.preventDefault();h.add(l).add(r).add(o).add(f).add(u).hide(0,function(){c.src=""});r.removeClass("loading")})},c.onload=function(){var s=c.height,i=c.width,b=n(r).height(),l=n(window).height(),a=n(window).width(),y,p,w;i>a-100&&(y=i,p=s,i=a-100,s=p*i/y);n(c).height(s).width(i).hide();n(".c_c div").animate({height:s+"px",width:i+"px"},t.my_speed);w=s/l*2.3;h_fix=l<s?w:2;r.animate({height:s+40+"px",width:i+40+"px",marginLeft:"-"+(i/2+20)+"px",marginTop:parseInt(n(document).scrollTop())-s/h_fix},t.my_speed,function(){n(".piro_nav,.caption").css({width:i+"px","margin-bottom":"10px"});n(".piro_nav").css("margin-left","-"+i/2+"px");var s=o.height();n(".c_c div").append(c);h.css("display","block");f.add(u).add(h).css("visibility","visible");o.css({visibility:"visible",display:"block",opacity:"1.0",overflow:"hidden"});r.hover(function(){o.stop().fadeTo(200,1)},function(){});n(c).fadeIn(300);r.removeClass("loading");t.slideShow===!0?e.add(v).show():e.add(v).hide()})},c.src=s,n("html").bind("keyup",function(t){t.keyCode==27&&(t.preventDefault(),(n(c).is(":visible")||n(".c_c>div>p>a").is(".close_pirobox"))&&(n(i).removeClass("slideshow").removeClass("item"),h.add(l).add(r).add(o).add(f).add(u).hide(0,function(){c.src=""}),r.removeClass("loading"),clearTimeout(a),n(i).children().removeAttr("class"),n(".stop").remove(),n(".c_c").append(e),n(".sc_menu").css("display","none"),n("ul.sc_menu li a").removeClass("img_active").css("opacity","0.4"),f.add(u).show().css({top:"50%"}),n(i).children().fadeTo(100,1)))}),n("html").bind("keyup",function(t){n(".item").is(".first")||t.keyCode==37&&(t.preventDefault(),n(c).is(":visible")&&(clearTimeout(a),n(i).children().removeAttr("class"),n(".stop").remove(),n(".c_c").append(e),u.click()))}),n("html").bind("keyup",function(t){n(".item").is(".last")||t.keyCode==39&&(t.preventDefault(),n(c).is(":visible")&&(clearTimeout(a),n(i).children().removeAttr("class"),n(".stop").remove(),n(".c_c").append(e),f.click()))}),p=n(window).height(),v.bind("click",function(t){t.preventDefault();clearTimeout(a);n(i).removeClass("slideshow");n(".stop").remove();n(".pirobox_down").append(e);f.add(u).css("width",y+"px")}),e.bind("click",function(t){return t.preventDefault(),clearTimeout(a),n(c).is(":visible")&&(n(i).addClass("slideshow"),n(".play").remove(),n(".pirobox_down").append(v)),f.add(u).css({width:"0px"}),slideshow()}),n(t.close_all).bind("click",function(t){n(i).removeClass("slideshow");clearTimeout(a);n(c).is(":visible")&&(t.preventDefault(),h.add(l).add(r).add(o).add(f).add(u).hide(0,function(){c.src=""}),r.removeClass("loading"),n(i).removeClass("slideshow"),f.add(u).css("width",y+"px").hide(),n(".stop").remove(),n(".pirobox_down").append(e),e.hide())}),t.slideShow===!0)){function slideshow(){n(i).filter(".item").is(".last")?(clearTimeout(a),n(i).removeClass("slideshow"),n(".stop").remove(),n(".pirobox_down").append(e),f.add(u).css("width",y+"px")):n(i).is(".slideshow")&&n(c).is(":visible")&&(clearTimeout(a),f.click())}a=setInterval(slideshow,t.slideSpeed*1e3)}}}t=jQuery.extend({my_speed:null,close_speed:300,bg_alpha:.5,close_all:".piro_close,.piro_overlay",slideShow:null,slideSpeed:null},t);i()}})(jQuery);