(function(n){n.widget("ui.selectable",n.ui.mouse,{options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch"},_create:function(){var i=this,t;this.element.addClass("ui-selectable");this.dragged=!1;this.refresh=function(){t=n(i.options.filter,i.element[0]);t.each(function(){var t=n(this),i=t.offset();n.data(this,"selectable-item",{element:this,$element:t,left:i.left,top:i.top,right:i.left+t.outerWidth(),bottom:i.top+t.outerHeight(),startselected:!1,selected:t.hasClass("ui-selected"),selecting:t.hasClass("ui-selecting"),unselecting:t.hasClass("ui-unselecting")})})};this.refresh();this.selectees=t.addClass("ui-selectee");this._mouseInit();this.helper=n("<div class='ui-selectable-helper'><\/div>")},destroy:function(){return this.selectees.removeClass("ui-selectee").removeData("selectable-item"),this.element.removeClass("ui-selectable ui-selectable-disabled").removeData("selectable").unbind(".selectable"),this._mouseDestroy(),this},_mouseStart:function(t){var r=this,i;(this.opos=[t.pageX,t.pageY],this.options.disabled)||(i=this.options,this.selectees=n(i.filter,this.element[0]),this._trigger("start",t),n(i.appendTo).append(this.helper),this.helper.css({left:t.clientX,top:t.clientY,width:0,height:0}),i.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var i=n.data(this,"selectable-item");i.startselected=!0;t.metaKey||(i.$element.removeClass("ui-selected"),i.selected=!1,i.$element.addClass("ui-unselecting"),i.unselecting=!0,r._trigger("unselecting",t,{unselecting:i.element}))}),n(t.target).parents().andSelf().each(function(){var i=n.data(this,"selectable-item"),u;if(i)return u=!t.metaKey||!i.$element.hasClass("ui-selected"),i.$element.removeClass(u?"ui-unselecting":"ui-selected").addClass(u?"ui-selecting":"ui-unselecting"),i.unselecting=!u,i.selecting=u,i.selected=u,u?r._trigger("selecting",t,{selecting:i.element}):r._trigger("unselecting",t,{unselecting:i.element}),!1}))},_mouseDrag:function(t){var e=this,o;if(this.dragged=!0,!this.options.disabled){var s=this.options,i=this.opos[0],r=this.opos[1],u=t.pageX,f=t.pageY;return i>u&&(o=u,u=i,i=o),r>f&&(o=f,f=r,r=o),this.helper.css({left:i,top:r,width:u-i,height:f-r}),this.selectees.each(function(){var o=n.data(this,"selectable-item"),h;o&&o.element!=e.element[0]&&(h=!1,s.tolerance=="touch"?h=!(o.left>u||o.right<i||o.top>f||o.bottom<r):s.tolerance=="fit"&&(h=o.left>i&&o.right<u&&o.top>r&&o.bottom<f),h?(o.selected&&(o.$element.removeClass("ui-selected"),o.selected=!1),o.unselecting&&(o.$element.removeClass("ui-unselecting"),o.unselecting=!1),o.selecting||(o.$element.addClass("ui-selecting"),o.selecting=!0,e._trigger("selecting",t,{selecting:o.element}))):(o.selecting&&(t.metaKey&&o.startselected?(o.$element.removeClass("ui-selecting"),o.selecting=!1,o.$element.addClass("ui-selected"),o.selected=!0):(o.$element.removeClass("ui-selecting"),o.selecting=!1,o.startselected&&(o.$element.addClass("ui-unselecting"),o.unselecting=!0),e._trigger("unselecting",t,{unselecting:o.element}))),o.selected&&(t.metaKey||o.startselected||(o.$element.removeClass("ui-selected"),o.selected=!1,o.$element.addClass("ui-unselecting"),o.unselecting=!0,e._trigger("unselecting",t,{unselecting:o.element})))))}),!1}},_mouseStop:function(t){var i=this,r;return this.dragged=!1,r=this.options,n(".ui-unselecting",this.element[0]).each(function(){var r=n.data(this,"selectable-item");r.$element.removeClass("ui-unselecting");r.unselecting=!1;r.startselected=!1;i._trigger("unselected",t,{unselected:r.element})}),n(".ui-selecting",this.element[0]).each(function(){var r=n.data(this,"selectable-item");r.$element.removeClass("ui-selecting").addClass("ui-selected");r.selecting=!1;r.selected=!0;r.startselected=!0;i._trigger("selected",t,{selected:r.element})}),this._trigger("stop",t),this.helper.remove(),!1}});n.extend(n.ui.selectable,{version:"@VERSION"})})(jQuery);