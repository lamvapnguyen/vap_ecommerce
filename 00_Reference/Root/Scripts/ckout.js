function _check_ccard(n,t){var r=$(n).val(),e=$("#sl_cardtype").val(),u,f,i;switch(e){case"Visa":if(r.length!=13&&r.length!=16||parseInt(r.substr(0,1))!=4){t(!1);return}break;case"Master":if(r.length!=16||parseInt(r.substr(0,2))<51||parseInt(r.substr(0,2))>55){t(!1);return}break;case"American Express":if(r.length!=15||parseInt(r.substr(0,2))!=34&&parseInt(r.substr(0,2))!=37){t(!1);return}break;case"Discover":if(r.length!=16||parseInt(r.substr(0,5))!=6011){t(!1);return}}for(u=[],f=0,i=0;i<r.length;i++)u[i]=parseInt(r[i].toString());for(i=u.length-2;i>-1;i-=2)u[i]*=2,u[i]>9&&(u[i]-=9);for(i=0;i<u.length;i++)f+=u[i];if(f%10!=0){t(!1);return}t(!0)}var _fhander_quan_huyen=function(n,t){var i=$(n).val();i>0&&($("#"+t).html("<option value='0'>-- loading --<\/option>"),$.post(__gvars.ajurl,{action:"optlist_quan",s:i},function(n){$("#"+t).html(n);$("#"+t).unbind("change").val(__ckout.quanID).change(function(){var i=$("#ckb_ship").is(":checked")?$("#payment_quanhuyen"):$("#ship_quanhuyen"),n=i.val(),u=i.find('option[value="'+n+'"]').text(),f=$("#sl_shipping_method").val(),r;$("#hdf_"+t).val(u);n>0&&(r=$("#hdf_ship_total0").val(),$.post(__gvars.ajurl,{action:"ec_optlist_ship",q:n,t:f,total:r},function(n){var t=n.split("<@>");n=t[0];n==""&&(n="0");$("#hdf_ship_fee").val(n);$("#tbl_ec_shipfee").text(t[1]);$("#tbl_ec_total").text(t[2])}))}).change()}))},_fhander_payment_country=function(n){var t=$("#payment_country").val();$("#payment_country").parent().children("input[type=hidden]:first").val($("#payment_country option:selected").text());$("#payment_state").html("<option value=''>-- loading --<\/option>");$.post(__gvars.ajurl,{action:"load_state",country:t,selected:n},function(n){n!=""&&$("#payment_state").html(n).val(__ckout.stateID).change()})},_fhander_ship_country=function(n){var t=$("#ship_country").val();$("#ship_country").parent().children("input[type=hidden]:first").val($("#ship_country option:selected").text());$("#ship_state").html("<option value=''>-- loading --<\/option>");$.post(__gvars.ajurl,{action:"load_state",country:t,selected:n},function(n){n!=""&&$("#ship_state").html(n).val(__ckout.stateID).change()})},__ckout={stateID:"0",quanID:"0",formID:"",choose_payment_gateway:function(n){var t=$(n).val();$(n).next().children().hide();$("#gateway_"+t).show();$("#hdf_payment_gateway").val(t)},choose_shipping_method:function(n){var t=$(n).val();$("#hdf_ship_gateway").val(t)},init_datepicker:function(n){$("#"+n).datepicker({minDate:0,defaultDate:0,dateFormat:"dd/mm/yy",showAnim:"slideDown"})},use_payment_info:function(n){var t=$(n).is(":checked");t?($("#ship_state").unbind("change"),$("#dco_ship_info :text").prop("disabled",t).css("background","#f5f5f5").val(""),$("#dco_ship_info select").prop("disabled",t).css("background","#f5f5f5")):($("#ship_state").unbind("change").change(function(){_fhander_quan_huyen(this,"ship_quanhuyen")}),$("#dco_ship_info :text").prop("disabled",t).css("background","#ffffff"),$("#dco_ship_info select").prop("disabled",t).css("background","#ffffff"))},check_empty:function(n){var t=$("#"+n).val(),i=t!="",r;return i?($("#err_info_email").hide(),r=/\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*/,t!=""&&r.test(t)||($("#err_info_email").show(),i=!1)):$("#err_info_email").show(),i},init_step1:function(){$(".cbox_tab_content>div").hide();var n=$("#hdf_logintype").val();switch(n){case"2":$("#cbox_tab_2_content").show();$("#cbox_tab_2").prop("checked",!0);break;case"3":$("#cbox_tab_3_content").show();$("#cbox_tab_3").prop("checked",!0);break;default:$("#cbox_tab_1_content").show();$("#cbox_tab_1").prop("checked",!0);$("#hdf_logintype").val(1)}$('.cbox_tab input[type="radio"]').click(function(){$(".cbox_tab_content>div").hide();var n=$(this),t=n.attr("id"),i=n.val();$("#"+t+"_content").show();$("#hdf_logintype").val(i);$(".error_c").hide()});$("#co_login_change").click(function(){show_loading();$.post(__gvars.asesurl,{action:"restart_checkout"},function(){hide_loading();window.location.reload()})})},init_step2:function(){$("#ckb_ship").click(function(){__ckout.use_payment_info(this)});$("#sl_payment_gateway").change(function(){__ckout.choose_payment_gateway(this)}).change();$("#sl_shipping_method").change(function(){var t;__ckout.choose_shipping_method(this);var i=$("#ckb_ship").is(":checked")?$("#payment_quanhuyen"):$("#ship_quanhuyen"),n=i.val(),r=$(this).val();n>0&&(t=$("#hdf_ship_total0").val(),$.post(__gvars.ajurl,{action:"ec_optlist_ship",q:n,t:r,total:t},function(n){var t=n.split("<@>");n=t[0];n==""&&(n="0");$("#hdf_ship_fee").val(n);$("#tbl_ec_shipfee").text(t[1]);$("#tbl_ec_total").text(t[2])}))}).change();$("#payment_country").change(_fhander_payment_country);$("#payment_state").change(function(){$(this).parent().children("input[type=hidden]:first").val($("#payment_country option:selected").text())});$("#ship_country").change(_fhander_ship_country);$("#ship_state").change(function(){$(this).parent().children("input[type=hidden]:first").val($("#ship_country option:selected").text())});_fhander_payment_country();_fhander_ship_country();__ckout.init_datepicker("ship_date_txt");$("#payment_state").change(function(){_fhander_quan_huyen(this,"payment_quanhuyen")});$("#ship_state").change(function(){_fhander_quan_huyen(this,"ship_quanhuyen")});$("#dco_ship_info :text").prop("disabled",!0).css("background","#f5f5f5").val("");$("#dco_ship_info select").prop("disabled",!0).css("background","#f5f5f5");$("#"+__ckout.formID).validationEngine()}};